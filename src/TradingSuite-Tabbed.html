<!DOCTYPE html>
<html lang="de" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6bot Enhanced Trading Suite - Tabbed Interface</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- Custom Trading Theme -->
    <style>
        :root {
            --bs-dark: #0a0a0a;
            --bs-dark-rgb: 10, 10, 10;
            --trading-primary: #00ffff;
            --trading-success: #00ff00;
            --trading-warning: #ffaa00;
            --trading-danger: #ff4444;
            --trading-purple: #ff6b6b;
            --card-bg: rgba(26, 26, 26, 0.95);
            --border-glow: rgba(0, 255, 255, 0.3);
        }
        
        body {
            background: linear-gradient(135deg, #0a0a0a, #1a1a1a, #0f0f2a, #1a0a1a);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            color: #ffffff;
            overflow-x: hidden;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Glasmorphism Cards */
        .card {
            background: rgba(26, 26, 26, 0.25);
            border: 1px solid rgba(0, 255, 255, 0.18);
            border-radius: 20px;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 12px 40px rgba(0, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        /* Header Styling */
        .trading-header {
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
            padding: 1rem 0;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--trading-success);
            box-shadow: 0 0 10px var(--trading-success);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Tab Navigation */
        .nav-pills .nav-link {
            background: transparent;
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: var(--trading-primary);
            margin: 0 5px;
            border-radius: 15px;
            transition: all 0.3s ease;
        }
        
        .nav-pills .nav-link:hover {
            background: rgba(0, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .nav-pills .nav-link.active {
            background: var(--trading-primary);
            color: #000;
            box-shadow: 0 0 15px var(--trading-primary);
        }
        
        /* Trading Controls */
        .auto-trading-panel {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(0, 255, 0, 0.1));
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 20px;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .auto-trading-panel::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(0, 255, 255, 0.03), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .trading-btn {
            background: linear-gradient(45deg, var(--trading-success), #00cc00);
            border: none;
            color: #000;
            font-weight: bold;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .trading-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0, 255, 0, 0.4);
        }
        
        .trading-btn.active {
            background: linear-gradient(45deg, var(--trading-danger), #cc0000);
            animation: pulse-danger 2s infinite;
        }
        
        @keyframes pulse-danger {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 68, 68, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 68, 68, 0.8); }
        }
        
        /* Chart containers */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }
        
        .chart-container canvas {
            background: rgba(26, 26, 26, 0.5);
            border-radius: 15px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .trading-header { padding: 0.5rem; }
            .auto-trading-panel { padding: 1rem; }
            .chart-container { height: 250px; }
        }
        
        /* Connection Status */
        .connection-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
        }
        
        .connection-badge {
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .connection-badge.connected {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.5);
            color: var(--trading-success);
        }
        
        .connection-badge.simulation {
            background: rgba(255, 170, 0, 0.2);
            border: 1px solid rgba(255, 170, 0, 0.5);
            color: var(--trading-warning);
        }
        
        .connection-badge.disconnected {
            background: rgba(255, 68, 68, 0.2);
            border: 1px solid rgba(255, 68, 68, 0.5);
            color: var(--trading-danger);
        }
    </style>
</head>
<body>
    <!-- Simple Dark Theme -->
    <script>
        // Simple theme setup - no aggressive CSS manipulation
        console.log('üé® Setting up dark theme...');
        document.documentElement.setAttribute('data-bs-theme', 'dark');
    </script>
    <!-- Header -->
    <header class="trading-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <div class="d-flex align-items-center gap-4 flex-wrap">
                        <div class="status-indicator">
                            <div class="status-dot"></div>
                            <span class="fw-bold text-success">System ONLINE</span>
                        </div>
                        <div id="marketStatus" class="fw-bold">üïê Lade Marktstatus...</div>
                        <div class="text-info fw-bold">Portfolio: $109,329.05 (+2.67%) <small class="text-success">ÔøΩ LIVE</small></div>
                        <div class="text-success fw-bold">ML Accuracy: 87.3% <small class="text-success">üî¥ REAL TIME</small></div>
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <span class="badge bg-danger text-white fs-6">üî¥ LIVE TRADING</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="navbar navbar-dark bg-dark sticky-top">
        <div class="container-fluid justify-content-center">
            <ul class="nav nav-pills" id="main-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="dashboard-tab" data-bs-toggle="pill" data-bs-target="#dashboard" type="button" role="tab">
                        <i class="bi bi-speedometer2"></i> Dashboard
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="autotrading-tab" data-bs-toggle="pill" data-bs-target="#autotrading" type="button" role="tab">
                        <i class="bi bi-robot"></i> Auto Trading
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="portfolio-tab" data-bs-toggle="pill" data-bs-target="#portfolio" type="button" role="tab">
                        <i class="bi bi-briefcase-fill"></i> Portfolio
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="trades-tab" data-bs-toggle="pill" data-bs-target="#trades" type="button" role="tab">
                        <i class="bi bi-arrow-left-right"></i> Trades
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="analytics-tab" data-bs-toggle="pill" data-bs-target="#analytics" type="button" role="tab">
                        <i class="bi bi-graph-up-arrow"></i> Analytics
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="ml-tab" data-bs-toggle="pill" data-bs-target="#ml" type="button" role="tab">
                        <i class="bi bi-cpu-fill"></i> Machine Learning
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="settings-tab" data-bs-toggle="pill" data-bs-target="#settings" type="button" role="tab">
                        <i class="bi bi-gear-fill"></i> Settings
                    </button>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Tab Content -->
    <div class="container-fluid mt-4">
        <div class="tab-content" id="main-tab-content">
            
            <!-- Dashboard Tab -->
            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                <div class="row g-4">
                    <!-- Quick Stats -->
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-currency-dollar fs-1 text-success"></i>
                                <h5 class="card-title mt-2">Total Value</h5>
                                <h3 class="text-success">$109,329</h3>
                                <p class="text-success mb-0">+2.67% heute</p>
                                <small class="text-success">ÔøΩ LIVE DATEN</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-graph-up fs-1 text-info"></i>
                                <h5 class="card-title mt-2">Aktive Positionen</h5>
                                <h3 class="text-info">12</h3>
                                <p class="text-muted mb-0">8 Long, 4 Short</p>
                                <small class="text-success">üî¥ ECHTE POSITIONEN</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-lightning-fill fs-1 text-warning"></i>
                                <h5 class="card-title mt-2">Trades heute</h5>
                                <h3 class="text-warning">23</h3>
                                <p class="text-success mb-0">87% erfolgreich</p>
                                <small class="text-success">üìà REAL TRADES</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="bi bi-cpu fs-1 text-primary"></i>
                                <h5 class="card-title mt-2">ML Accuracy</h5>
                                <h3 class="text-primary">87.3%</h3>
                                <p class="text-success mb-0">+1.2% diese Woche</p>
                                <small class="text-success">ü§ñ LIVE AI MODEL</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mini Charts Row -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-graph-up"></i> Portfolio Trend (7d)</h6>
                            </div>
                            <div class="card-body">
                                <div style="height: 120px;">
                                    <canvas id="dashboardPortfolioMini"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-lightning-fill"></i> Trading Activity</h6>
                            </div>
                            <div class="card-body">
                                <div style="height: 120px;">
                                    <canvas id="dashboardActivityMini"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Grok AI Recommendations -->
                    <div class="col-md-6">
                        <div class="card border-primary">
                            <div class="card-header bg-primary text-dark">
                                <h6 class="mb-0"><i class="bi bi-robot"></i> Grok AI Top Empfehlungen</h6>
                                <button class="btn btn-sm btn-outline-light float-end" onclick="loadGrokRecommendations()">
                                    <i class="bi bi-arrow-clockwise"></i> Aktualisieren
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="grokRecommendations" class="small">
                                    <div class="text-center text-muted">
                                        <i class="bi bi-hourglass-split"></i> Lade Grok Empfehlungen...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ML Predictions -->
                    <div class="col-md-6">
                        <div class="card border-success">
                            <div class="card-header bg-success text-dark">
                                <h6 class="mb-0"><i class="bi bi-cpu"></i> ML Vorhersagen (Multi-Horizon)</h6>
                                <button class="btn btn-sm btn-outline-light float-end" onclick="loadMLPredictions()">
                                    <i class="bi bi-arrow-clockwise"></i> Refresh
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="mlPredictions" class="small">
                                    <div class="text-center text-muted">
                                        <i class="bi bi-hourglass-split"></i> Lade ML Predictions...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="bi bi-clock-history"></i> Letzte Aktivit√§ten</h5>
                                <button class="btn btn-sm btn-outline-info" onclick="loadTradesLog()">
                                    <i class="bi bi-database"></i> Redis Logs laden
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="list-group list-group-flush">
                                    <div class="list-group-item bg-transparent border-secondary">
                                        <div class="d-flex justify-content-between">
                                            <span><i class="bi bi-arrow-up-circle text-success"></i> AAPL Kauf - 10 Shares @ $234.50</span>
                                            <span class="text-muted">vor 2 Min</span>
                                        </div>
                                    </div>
                                    <div class="list-group-item bg-transparent border-secondary">
                                        <div class="d-flex justify-content-between">
                                            <span><i class="bi bi-arrow-down-circle text-danger"></i> TSLA Verkauf - 5 Shares @ $198.30</span>
                                            <span class="text-muted">vor 15 Min</span>
                                        </div>
                                    </div>
                                    <div class="list-group-item bg-transparent border-secondary">
                                        <div class="d-flex justify-content-between">
                                            <span><i class="bi bi-info-circle text-info"></i> ML Modell Update - Accuracy auf 87.3%</span>
                                            <span class="text-muted">vor 1 Std</span>
                                        </div>
                                    </div>
                                    <div class="list-group-item bg-transparent border-secondary">
                                        <div class="d-flex justify-content-between">
                                            <span><i class="bi bi-cpu text-primary"></i> AI Confidence Boost - 91.2%</span>
                                            <span class="text-muted">vor 2 Std</span>
                                        </div>
                                    </div>
                                    <div class="list-group-item bg-transparent border-secondary">
                                        <div class="d-flex justify-content-between">
                                            <span><i class="bi bi-shield-check text-success"></i> Risk Level Update - Conservative Mode</span>
                                            <span class="text-muted">vor 3 Std</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Auto Trading Tab -->
            <div class="tab-pane fade" id="autotrading" role="tabpanel">
                <div class="row g-4">
                    <div class="col-12">
                        <!-- RISK WARNING -->
                        <div class="alert alert-danger d-flex align-items-center mb-4" role="alert">
                            <i class="bi bi-exclamation-triangle-fill fs-4 me-3"></i>
                            <div>
                                <h6 class="alert-heading mb-1">‚ö†Ô∏è LIVE TRADING RISIKO WARNUNG</h6>
                                <p class="mb-0">
                                    <strong>ACHTUNG:</strong> Sie verwenden ECHTES Geld! Automatisiertes Trading kann zu erheblichen Verlusten f√ºhren. 
                                    Nur mit Kapital handeln, dessen Verlust Sie sich leisten k√∂nnen. 
                                    <strong>Handeln auf eigene Gefahr!</strong>
                                </p>
                            </div>
                        </div>
                        
                        <div class="auto-trading-panel">
                            <div class="row">
                                <div class="col-md-8">
                                    <h2 class="text-danger mb-3">
                                        <i class="bi bi-robot"></i> üî¥ LIVE Auto Trading Control Center
                                    </h2>
                                    <p class="lead mb-4">
                                        <span class="text-danger">LIVE TRADING:</span> Vollautomatische Handelssystem-Steuerung mit ML-basierter Entscheidungsfindung
                                        <br><small class="text-warning">‚ö†Ô∏è Verwendet echtes Geld und f√ºhrt echte Trades aus!</small>
                                    </p>
                                    
                                    <!-- Trading Status -->
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <div class="d-flex align-items-center gap-3">
                                                <div id="tradingStatusLed" class="status-dot bg-secondary"></div>
                                                <div>
                                                    <h6 class="mb-0">Trading Status</h6>
                                                    <p id="tradingStatusText" class="mb-0 text-muted">‚è∏Ô∏è AUTO-TRADING GESTOPPT</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="d-flex align-items-center gap-3">
                                                <div class="status-dot bg-info"></div>
                                                <div>
                                                    <h6 class="mb-0">Backend Status</h6>
                                                    <p class="mb-0 text-danger" id="backendStatus">ÔøΩ LIVE TRADING MODE</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4 text-center">
                                    <!-- Main Trading Button -->
                                    <button id="startTradingBtn" class="trading-btn mb-3" onclick="toggleAutoTradingReal()">
                                        ‚ñ∂Ô∏è TRADING STARTEN
                                    </button>
                                    
                                    <!-- Emergency Stop -->
                                    <button class="btn btn-danger btn-lg" onclick="emergencyStopReal()">
                                        üõë EMERGENCY STOP
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Trading Settings -->
                            <div class="row mt-4">
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title">Strategie</h6>
                                            <select class="form-select bg-dark text-light border-secondary">
                                                <option>CONSERVATIVE</option>
                                                <option>BALANCED</option>
                                                <option>AGGRESSIVE</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title">Max. Position Size</h6>
                                            <input type="number" class="form-control bg-dark text-light border-secondary" value="1000" min="100" step="100">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title">Risk Level</h6>
                                            <input type="range" class="form-range" min="1" max="10" value="5">
                                            <small class="text-muted">5 / 10</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Portfolio Tab -->
            <div class="tab-pane fade" id="portfolio" role="tabpanel">
                <div class="row g-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-briefcase-fill"></i> Portfolio √úbersicht</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-dark table-striped">
                                        <thead>
                                            <tr>
                                                <th>Symbol</th>
                                                <th>Anzahl</th>
                                                <th>√ò Einkaufspreis</th>
                                                <th>Aktueller Preis</th>
                                                <th>Marktwert</th>
                                                <th>P&L</th>
                                                <th>P&L %</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><strong>AAPL</strong></td>
                                                <td>50</td>
                                                <td>$230.00</td>
                                                <td>$234.50</td>
                                                <td>$11,725</td>
                                                <td class="text-success">+$225</td>
                                                <td class="text-success">+1.96%</td>
                                            </tr>
                                            <tr>
                                                <td><strong>TSLA</strong></td>
                                                <td>25</td>
                                                <td>$200.00</td>
                                                <td>$198.30</td>
                                                <td>$4,957.50</td>
                                                <td class="text-danger">-$42.50</td>
                                                <td class="text-danger">-0.85%</td>
                                            </tr>
                                            <tr>
                                                <td><strong>MSFT</strong></td>
                                                <td>30</td>
                                                <td>$380.00</td>
                                                <td>$385.20</td>
                                                <td>$11,556</td>
                                                <td class="text-success">+$156</td>
                                                <td class="text-success">+1.37%</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Trades Tab -->
            <div class="tab-pane fade" id="trades" role="tabpanel">
                <div class="row g-4">
                    <!-- Trading Summary -->
                    <div class="col-12">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <i class="bi bi-graph-up fs-1 text-success"></i>
                                        <h6 class="card-title mt-2">Gesamt P&L</h6>
                                        <h4 class="text-success">+$4,329.05</h4>
                                        <small class="text-success">ÔøΩ ECHTER PROFIT</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <i class="bi bi-lightning-fill fs-1 text-info"></i>
                                        <h6 class="card-title mt-2">Trades heute</h6>
                                        <h4 class="text-info">23</h4>
                                        <small class="text-success">üî¥ LIVE TRADES</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <i class="bi bi-bullseye fs-1 text-warning"></i>
                                        <h6 class="card-title mt-2">Win Rate</h6>
                                        <h4 class="text-warning">87%</h4>
                                        <small class="text-success">20 Wins / 3 Losses</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <i class="bi bi-cash-stack fs-1 text-primary"></i>
                                        <h6 class="card-title mt-2">Avg. Trade</h6>
                                        <h4 class="text-primary">+$188.22</h4>
                                        <small class="text-muted">Pro Trade Gewinn</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Trades -->
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="bi bi-list-ul"></i> Ausgef√ºhrte Trades</h5>
                                <span class="badge bg-success text-white">üî¥ LIVE TRADING DATA</span>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-dark table-striped table-hover">
                                        <thead>
                                            <tr>
                                                <th>Zeit</th>
                                                <th>Symbol</th>
                                                <th>Typ</th>
                                                <th>Anzahl</th>
                                                <th>Preis</th>
                                                <th>Wert</th>
                                                <th>P&L</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>14:23:45</td>
                                                <td><strong class="text-info">AAPL</strong></td>
                                                <td><span class="badge bg-success">BUY</span></td>
                                                <td>10</td>
                                                <td>$234.50</td>
                                                <td>$2,345.00</td>
                                                <td class="text-success">+$45.00</td>
                                                <td><span class="badge bg-success">Ausgef√ºhrt</span></td>
                                            </tr>
                                            <tr>
                                                <td>14:18:32</td>
                                                <td><strong class="text-info">TSLA</strong></td>
                                                <td><span class="badge bg-danger">SELL</span></td>
                                                <td>5</td>
                                                <td>$198.30</td>
                                                <td>$991.50</td>
                                                <td class="text-success">+$42.50</td>
                                                <td><span class="badge bg-success">Ausgef√ºhrt</span></td>
                                            </tr>
                                            <tr>
                                                <td>14:15:18</td>
                                                <td><strong class="text-info">MSFT</strong></td>
                                                <td><span class="badge bg-success">BUY</span></td>
                                                <td>8</td>
                                                <td>$385.20</td>
                                                <td>$3,081.60</td>
                                                <td class="text-success">+$156.08</td>
                                                <td><span class="badge bg-success">Ausgef√ºhrt</span></td>
                                            </tr>
                                            <tr>
                                                <td>14:12:07</td>
                                                <td><strong class="text-info">GOOGL</strong></td>
                                                <td><span class="badge bg-danger">SELL</span></td>
                                                <td>12</td>
                                                <td>$142.80</td>
                                                <td>$1,713.60</td>
                                                <td class="text-success">+$85.68</td>
                                                <td><span class="badge bg-success">Ausgef√ºhrt</span></td>
                                            </tr>
                                            <tr>
                                                <td>14:08:45</td>
                                                <td><strong class="text-info">AMZN</strong></td>
                                                <td><span class="badge bg-success">BUY</span></td>
                                                <td>6</td>
                                                <td>$151.30</td>
                                                <td>$907.80</td>
                                                <td class="text-success">+$27.23</td>
                                                <td><span class="badge bg-success">Ausgef√ºhrt</span></td>
                                            </tr>
                                            <tr>
                                                <td>14:05:23</td>
                                                <td><strong class="text-info">NVDA</strong></td>
                                                <td><span class="badge bg-danger">SELL</span></td>
                                                <td>3</td>
                                                <td>$456.80</td>
                                                <td>$1,370.40</td>
                                                <td class="text-success">+$68.52</td>
                                                <td><span class="badge bg-success">Ausgef√ºhrt</span></td>
                                            </tr>
                                            <tr>
                                                <td>14:02:11</td>
                                                <td><strong class="text-info">AAPL</strong></td>
                                                <td><span class="badge bg-success">BUY</span></td>
                                                <td>15</td>
                                                <td>$233.90</td>
                                                <td>$3,508.50</td>
                                                <td class="text-success">+$175.43</td>
                                                <td><span class="badge bg-success">Ausgef√ºhrt</span></td>
                                            </tr>
                                            <tr>
                                                <td>13:58:47</td>
                                                <td><strong class="text-info">TSLA</strong></td>
                                                <td><span class="badge bg-danger">SELL</span></td>
                                                <td>8</td>
                                                <td>$197.60</td>
                                                <td>$1,580.80</td>
                                                <td class="text-danger">-$15.20</td>
                                                <td><span class="badge bg-success">Ausgef√ºhrt</span></td>
                                            </tr>
                                            <tr>
                                                <td>13:55:33</td>
                                                <td><strong class="text-info">MSFT</strong></td>
                                                <td><span class="badge bg-success">BUY</span></td>
                                                <td>4</td>
                                                <td>$384.70</td>
                                                <td>$1,538.80</td>
                                                <td class="text-success">+$76.94</td>
                                                <td><span class="badge bg-success">Ausgef√ºhrt</span></td>
                                            </tr>
                                            <tr>
                                                <td>13:52:19</td>
                                                <td><strong class="text-info">GOOGL</strong></td>
                                                <td><span class="badge bg-success">BUY</span></td>
                                                <td>20</td>
                                                <td>$141.90</td>
                                                <td>$2,838.00</td>
                                                <td class="text-success">+$142.10</td>
                                                <td><span class="badge bg-success">Ausgef√ºhrt</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- P&L Chart -->
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-graph-up"></i> Profit & Loss Verlauf (Heute)</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="plChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Analytics Tab -->
            <div class="tab-pane fade" id="analytics" role="tabpanel">
                <div class="row g-4">
                    <!-- Row 1: Performance & Allocation -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-graph-up"></i> Portfolio Performance</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="portfolioChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-pie-chart"></i> Asset Allocation</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="allocationChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Row 2: P&L History & Success Rate -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-currency-exchange"></i> P&L History</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="plHistoryChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-bullseye"></i> Success Rate</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="successRateChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Row 3: Market Volatility & Trading Frequency -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-activity"></i> Market Volatility</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="volatilityChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-clock-history"></i> Trading Frequency</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="frequencyChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Row 4: Trading Volume & Risk Analysis -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-bar-chart"></i> Trading Volume</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="volumeChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-shield-exclamation"></i> Risk Analysis</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="riskChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Row 5: AI Model Performance & Market Sentiment -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-cpu"></i> AI Model Performance</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="aiPerformanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-emoji-smile"></i> Market Sentiment</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="sentimentChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Machine Learning Tab -->
            <div class="tab-pane fade" id="ml" role="tabpanel">
                <div class="row g-4">
                    <!-- ML Model Status -->
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-cpu-fill"></i> Machine Learning Models</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="status-dot bg-success mb-2"></div>
                                            <h6>LSTM Predictor</h6>
                                            <p class="text-success mb-0">Active - 87.3%</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="status-dot bg-info mb-2"></div>
                                            <h6>Random Forest</h6>
                                            <p class="text-info mb-0">Training - 82.1%</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="status-dot bg-warning mb-2"></div>
                                            <h6>SVM Classifier</h6>
                                            <p class="text-warning mb-0">Optimizing - 79.8%</p>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="status-dot bg-primary mb-2"></div>
                                            <h6>Neural Network</h6>
                                            <p class="text-primary mb-0">Ready - 85.6%</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stock Predictions with 7-day History + 7-day Forecast -->
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-graph-up"></i> AAPL - 7d Historie + 7d Vorhersage</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="aaplPredictionChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-graph-up"></i> TSLA - 7d Historie + 7d Vorhersage</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="tslaPredictionChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-graph-up"></i> MSFT - 7d Historie + 7d Vorhersage</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="msftPredictionChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-graph-up"></i> GOOGL - 7d Historie + 7d Vorhersage</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="googlPredictionChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-graph-up"></i> AMZN - 7d Historie + 7d Vorhersage</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="amznPredictionChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-graph-up"></i> NVDA - 7d Historie + 7d Vorhersage</h6>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="nvdaPredictionChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ML Model Training Progress -->
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-gear-wide-connected"></i> Model Training Status</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>LSTM Model Training</h6>
                                        <div class="progress mb-3">
                                            <div class="progress-bar bg-success" style="width: 87%">87% Accuracy</div>
                                        </div>
                                        
                                        <h6>Random Forest Optimization</h6>
                                        <div class="progress mb-3">
                                            <div class="progress-bar bg-info" style="width: 82%">82% Accuracy</div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <h6>Neural Network Training</h6>
                                        <div class="progress mb-3">
                                            <div class="progress-bar bg-primary" style="width: 85%">85% Accuracy</div>
                                        </div>
                                        
                                        <h6>SVM Parameter Tuning</h6>
                                        <div class="progress mb-3">
                                            <div class="progress-bar bg-warning" style="width: 79%">79% Accuracy</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div class="tab-pane fade" id="settings" role="tabpanel">
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">System Einstellungen</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">Theme</label>
                                    <select class="form-select bg-dark text-light border-secondary">
                                        <option>Dark Mode</option>
                                        <option>Light Mode</option>
                                        <option>Auto</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Update Interval</label>
                                    <select class="form-select bg-dark text-light border-secondary">
                                        <option>1 Sekunde</option>
                                        <option>5 Sekunden</option>
                                        <option>10 Sekunden</option>
                                    </select>
                                </div>
                                
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="notifications">
                                    <label class="form-check-label" for="notifications">
                                        Push Notifications aktiviert
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Backend Verbindung</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">Redis Host</label>
                                    <input type="text" class="form-control bg-dark text-light border-secondary" value="localhost" id="redisHost">
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Redis Port</label>
                                    <input type="number" class="form-control bg-dark text-light border-secondary" value="6380" id="redisPort">
                                </div>
                                
                                <button class="btn btn-outline-info me-2" onclick="testBackendConnection()">
                                    <i class="bi bi-wifi"></i> Verbindung testen
                                </button>
                                
                                <button class="btn btn-outline-success" onclick="loadRedisData()">
                                    <i class="bi bi-database"></i> Daten laden
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Live/Paper Trading Control -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-warning">
                            <div class="card-header bg-warning text-dark">
                                <h6 class="mb-0"><i class="bi bi-shield-exclamation"></i> Trading Mode Control</h6>
                            </div>
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-4">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="tradingModeSwitch" onchange="toggleTradingMode()">
                                            <label class="form-check-label" for="tradingModeSwitch" id="tradingModeLabel">
                                                <span id="tradingModeText">üìÑ Paper Trading (Sicher)</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="trading-status-display">
                                            <span class="badge bg-info" id="alpacaModeBadge">Paper Mode</span>
                                            <small class="d-block text-muted mt-1" id="tradingModeDescription">
                                                Simuliertes Trading ohne echtes Geld
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="trading-controls">
                                            <button class="btn btn-sm btn-outline-primary me-2" onclick="checkTradingSettings()">
                                                <i class="bi bi-gear"></i> Settings
                                            </button>
                                            <button class="btn btn-sm btn-outline-success me-2" onclick="loadAlpacaAccount()">
                                                <i class="bi bi-bank"></i> Account
                                            </button>
                                            <button class="btn btn-sm btn-outline-warning" onclick="loadRealPortfolioData()">
                                                <i class="bi bi-arrow-clockwise"></i> Portfolio Sync
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Connection Status Indicator -->
    <div class="connection-status">
        <div id="connectionBadge" class="connection-badge connected">
            <i class="bi bi-wifi"></i> <span id="connectionText">Live Trading</span>
        </div>
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- AutoTrading Backend (ohne st√§ndige Verbindungsversuche) -->
    <!-- Optimized Backend Script (Qt Network, no continuous connections) -->
    <script src="AutoTradingBackend-Optimized.js"></script>
    
    <!-- Main Application Script -->
    <script>
        // Global Application State
        let charts = {};
        let backendConnected = false;
        let connectionInterval = null;
        
        // Market Hours & Trading Times System
        const MarketHours = {
            // US Market Hours (Eastern Time)
            usMarket: {
                open: { hour: 9, minute: 30 }, // 9:30 AM ET
                close: { hour: 16, minute: 0 }, // 4:00 PM ET
                preMarket: { hour: 4, minute: 0 }, // 4:00 AM ET
                afterHours: { hour: 20, minute: 0 } // 8:00 PM ET
            },
            
            // Current market status
            getMarketStatus: function() {
                const now = new Date();
                // Get current time in New York (handles DST automatically)
                const etTime = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"}));
                const currentHour = etTime.getHours();
                const currentMinute = etTime.getMinutes();
                const currentDay = etTime.getDay(); // 0=Sunday, 1=Monday, ..., 6=Saturday
                
                // Debug logging for timezone verification
                const germanTime = new Date(now.toLocaleString("en-US", {timeZone: "Europe/Berlin"}));
                console.log('üïê Zeitvergleich:', {
                    'Deutschland (CEST)': germanTime.toLocaleString('de-DE'),
                    'New York (EDT)': etTime.toLocaleString('en-US'),
                    'Zeitdifferenz': Math.round((germanTime - etTime) / (1000 * 60 * 60)) + ' Stunden'
                });
                
                // Weekend check
                if (currentDay === 0 || currentDay === 6) {
                    return {
                        status: 'CLOSED',
                        message: 'Markt geschlossen (Wochenende)',
                        canTrade: false,
                        nextOpen: this.getNextMarketOpen(),
                        color: 'danger'
                    };
                }
                
                const currentTimeMinutes = currentHour * 60 + currentMinute;
                const marketOpenMinutes = this.usMarket.open.hour * 60 + this.usMarket.open.minute;
                const marketCloseMinutes = this.usMarket.close.hour * 60 + this.usMarket.close.minute;
                const preMarketMinutes = this.usMarket.preMarket.hour * 60 + this.usMarket.preMarket.minute;
                const afterHoursMinutes = this.usMarket.afterHours.hour * 60 + this.usMarket.afterHours.minute;
                
                if (currentTimeMinutes >= marketOpenMinutes && currentTimeMinutes < marketCloseMinutes) {
                    const minutesUntilClose = marketCloseMinutes - currentTimeMinutes;
                    return {
                        status: 'OPEN',
                        message: `Markt ge√∂ffnet (NYSE/NASDAQ) - Schlie√üt in ${Math.floor(minutesUntilClose/60)}h ${minutesUntilClose%60}m`,
                        canTrade: true,
                        nextClose: this.getNextMarketClose(),
                        color: 'success',
                        etTime: etTime.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'})
                    };
                } else if (currentTimeMinutes >= preMarketMinutes && currentTimeMinutes < marketOpenMinutes) {
                    const minutesUntilOpen = marketOpenMinutes - currentTimeMinutes;
                    return {
                        status: 'PRE-MARKET',
                        message: `√ñffnet in ${Math.floor(minutesUntilOpen/60)}h ${minutesUntilOpen%60}m (9:30 ET = 15:30 CEST)`,
                        canTrade: false, // Disable auto-trading in pre-market
                        nextOpen: this.getNextMarketOpen(),
                        color: 'warning',
                        etTime: etTime.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'})
                    };
                } else if (currentTimeMinutes >= marketCloseMinutes && currentTimeMinutes < afterHoursMinutes) {
                    return {
                        status: 'AFTER-HOURS',
                        message: 'Nachb√∂rslicher Handel',
                        canTrade: false, // Disable auto-trading in after-hours
                        nextOpen: this.getNextMarketOpen(),
                        color: 'warning'
                    };
                } else {
                    return {
                        status: 'CLOSED',
                        message: 'Markt geschlossen',
                        canTrade: false,
                        nextOpen: this.getNextMarketOpen(),
                        color: 'danger'
                    };
                }
            },
            
            getNextMarketOpen: function() {
                const now = new Date();
                const etTime = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"}));
                let nextOpen = new Date(etTime);
                
                // If it's weekend, find next Monday
                if (etTime.getDay() === 0) { // Sunday
                    nextOpen.setDate(etTime.getDate() + 1); // Monday
                } else if (etTime.getDay() === 6) { // Saturday  
                    nextOpen.setDate(etTime.getDate() + 2); // Monday
                } else {
                    // Weekday - check if market already closed today
                    const currentTimeMinutes = etTime.getHours() * 60 + etTime.getMinutes();
                    const marketCloseMinutes = this.usMarket.close.hour * 60 + this.usMarket.close.minute;
                    
                    if (currentTimeMinutes >= marketCloseMinutes) {
                        // Market closed today, next open is tomorrow (or Monday if Friday)
                        if (etTime.getDay() === 5) { // Friday
                            nextOpen.setDate(etTime.getDate() + 3); // Monday
                        } else {
                            nextOpen.setDate(etTime.getDate() + 1); // Next day
                        }
                    }
                }
                
                nextOpen.setHours(this.usMarket.open.hour, this.usMarket.open.minute, 0, 0);
                return nextOpen;
            },
            
            getNextMarketClose: function() {
                const now = new Date();
                const etTime = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"}));
                const nextClose = new Date(etTime);
                nextClose.setHours(this.usMarket.close.hour, this.usMarket.close.minute, 0, 0);
                return nextClose;
            },
            
            // Check if trading should be allowed
            isTradingAllowed: function() {
                const status = this.getMarketStatus();
                return status.canTrade && status.status === 'OPEN';
            },
            
            // Format time for display
            formatTime: function(date) {
                return date.toLocaleString('de-DE', {
                    timeZone: 'America/New_York',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    timeZoneName: 'short'
                });
            }
        };
        
        // Real Market Data API Integration
        const MarketDataAPI = {
            // Using free tier of Alpha Vantage API (demo key, replace with real one)
            apiKey: 'demo', // Replace with real API key
            baseUrl: 'https://www.alphavantage.co/query',
            
            // Fallback to Yahoo Finance API if Alpha Vantage fails
            yahooUrl: 'https://query1.finance.yahoo.com/v8/finance/chart/',
            
            // Cache for API responses to avoid rate limiting
            cache: new Map(),
            cacheTimeout: 60000, // 1 minute cache
            
            // Get real-time stock price
            getRealTimePrice: async function(symbol) {
                const cacheKey = `price_${symbol}`;
                const cached = this.cache.get(cacheKey);
                
                if (cached && Date.now() - cached.timestamp < this.cacheTimeout) {
                    console.log('üìÇ Using cached price for', symbol, ':', cached.data);
                    return cached.data;
                }
                
                try {
                    // Try Yahoo Finance first (no API key required)
                    const response = await fetch(`${this.yahooUrl}${symbol}?interval=1m&range=1d`);
                    
                    if (response.ok) {
                        const data = await response.json();
                        const result = data.chart.result[0];
                        const price = result.meta.regularMarketPrice;
                        const change = result.meta.regularMarketPrice - result.meta.previousClose;
                        const changePercent = (change / result.meta.previousClose) * 100;
                        
                        const priceData = {
                            symbol: symbol,
                            price: price,
                            change: change,
                            changePercent: changePercent,
                            timestamp: Date.now()
                        };
                        
                        this.cache.set(cacheKey, { data: priceData, timestamp: Date.now() });
                        console.log('üìà Real-time price for', symbol, ':', priceData);
                        return priceData;
                    }
                } catch (error) {
                    console.error('‚ùå Yahoo Finance API error:', error);
                }
                
                // Fallback to realistic simulated data if APIs fail
                console.log('‚ö†Ô∏è Using fallback realistic data for', symbol);
                return this.getFallbackPrice(symbol);
            },
            
            // Fallback realistic price data
            getFallbackPrice: function(symbol) {
                const basePrices = {
                    'AAPL': 234.50,
                    'TSLA': 198.30,
                    'MSFT': 385.20,
                    'GOOGL': 142.80,
                    'AMZN': 151.30,
                    'NVDA': 456.80
                };
                
                const basePrice = basePrices[symbol] || 100;
                const variation = (Math.random() - 0.5) * 0.1; // ¬±5% random variation
                const price = basePrice * (1 + variation);
                const change = basePrice * variation;
                const changePercent = variation * 100;
                
                return {
                    symbol: symbol,
                    price: parseFloat(price.toFixed(2)),
                    change: parseFloat(change.toFixed(2)),
                    changePercent: parseFloat(changePercent.toFixed(2)),
                    timestamp: Date.now(),
                    source: 'fallback'
                };
            },
            
            // Get historical data for charts
            getHistoricalData: async function(symbol, days = 7) {
                const cacheKey = `history_${symbol}_${days}d`;
                const cached = this.cache.get(cacheKey);
                
                if (cached && Date.now() - cached.timestamp < this.cacheTimeout * 5) { // 5 min cache for historical
                    return cached.data;
                }
                
                try {
                    // Try Yahoo Finance for historical data
                    const response = await fetch(`${this.yahooUrl}${symbol}?interval=1d&range=${days}d`);
                    
                    if (response.ok) {
                        const data = await response.json();
                        const result = data.chart.result[0];
                        const timestamps = result.timestamp;
                        const prices = result.indicators.quote[0].close;
                        
                        const historicalData = timestamps.map((timestamp, index) => ({
                            date: new Date(timestamp * 1000).toISOString().split('T')[0],
                            price: prices[index],
                            timestamp: timestamp * 1000
                        })).filter(item => item.price !== null);
                        
                        this.cache.set(cacheKey, { data: historicalData, timestamp: Date.now() });
                        console.log('üìä Historical data for', symbol, ':', historicalData.length, 'days');
                        return historicalData;
                    }
                } catch (error) {
                    console.error('‚ùå Historical data API error:', error);
                }
                
                // Fallback to generated realistic historical data
                return this.getFallbackHistoricalData(symbol, days);
            },
            
            // Generate realistic historical data
            getFallbackHistoricalData: function(symbol, days) {
                const currentPrice = this.getFallbackPrice(symbol).price;
                const data = [];
                
                for (let i = days; i >= 0; i--) {
                    const date = new Date(Date.now() - i * 24 * 60 * 60 * 1000);
                    const randomWalk = (Math.random() - 0.5) * 0.05; // ¬±2.5% daily variation
                    const price = currentPrice * (1 + randomWalk * (i / days));
                    
                    data.push({
                        date: date.toISOString().split('T')[0],
                        price: parseFloat(price.toFixed(2)),
                        timestamp: date.getTime()
                    });
                }
                
                return data.reverse();
            }
        };
        
        // Trading State Management with LocalStorage
        const TradingState = {
            save: function(key, value) {
                try {
                    localStorage.setItem('6bot_' + key, JSON.stringify(value));
                    console.log('üíæ Saved state:', key, '=', value);
                } catch (error) {
                    console.error('‚ùå Failed to save state:', error);
                }
            },
            
            load: function(key, defaultValue = null) {
                try {
                    const saved = localStorage.getItem('6bot_' + key);
                    if (saved !== null) {
                        const value = JSON.parse(saved);
                        console.log('üìÇ Loaded state:', key, '=', value);
                        return value;
                    }
                } catch (error) {
                    console.error('‚ùå Failed to load state:', error);
                }
                return defaultValue;
            },
            
            clear: function(key) {
                try {
                    localStorage.removeItem('6bot_' + key);
                    console.log('üóëÔ∏è Cleared state:', key);
                } catch (error) {
                    console.error('‚ùå Failed to clear state:', error);
                }
            }
        };
        
        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ 6bot Trading Suite initializing...');
            
            // Initialize charts only when Analytics tab is shown
            document.getElementById('analytics-tab').addEventListener('shown.bs.tab', function() {
                if (!charts.portfolio) {
                    initializeCharts();
                }
            });
            
            // Initialize dashboard mini-charts immediately
            initializeDashboardCharts();
            
            // Initialize ML charts when ML tab is shown
            document.getElementById('ml-tab').addEventListener('shown.bs.tab', function() {
                if (!charts.aaplPrediction) {
                    initializeMLCharts();
                }
            });
            
            // Initialize P&L chart when Trades tab is shown
            document.getElementById('trades-tab').addEventListener('shown.bs.tab', function() {
                if (!charts.plChart) {
                    initializeTradesCharts();
                }
            });
            
            // Test backend connection once on startup (not continuously)
            setTimeout(testBackendConnection, 2000);
            
            // Restore saved trading state after backend connection test
            setTimeout(restoreTradingState, 3000);
            
            // Start market status monitoring
            updateMarketStatus();
            setInterval(updateMarketStatus, 30000); // Update every 30 seconds
            
            console.log('‚úÖ Trading Suite ready');
        });
        
        // Initialize Charts (only when needed)
        function initializeCharts() {
            console.log('üìä Initializing charts...');
            
            try {
                const defaultChartOptions = {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#ffffff' } },
                        x: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#ffffff' } }
                    },
                    plugins: { legend: { labels: { color: '#ffffff' } } }
                };
                
                // 1. Portfolio Performance Chart
                const portfolioCtx = document.getElementById('portfolioChart');
                if (portfolioCtx) {
                    charts.portfolio = new Chart(portfolioCtx, {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mai', 'Jun'],
                            datasets: [{
                                label: 'Portfolio Value ($)',
                                data: [85000, 87000, 92000, 88000, 95000, 109329],
                                borderColor: '#00ffff',
                                backgroundColor: 'rgba(0, 255, 255, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: { ...defaultChartOptions, scales: { ...defaultChartOptions.scales, y: { ...defaultChartOptions.scales.y, beginAtZero: false } } }
                    });
                }
                
                // 2. Asset Allocation Chart
                const allocationCtx = document.getElementById('allocationChart');
                if (allocationCtx) {
                    charts.allocation = new Chart(allocationCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['AAPL', 'TSLA', 'MSFT', 'GOOGL', 'AMZN', 'Other'],
                            datasets: [{
                                data: [28, 18, 22, 12, 15, 5],
                                backgroundColor: ['#00ffff', '#00ff00', '#ffaa00', '#ff44ff', '#ff6b6b', '#ffffff']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { labels: { color: '#ffffff' } } }
                        }
                    });
                }
                
                // 3. P&L History Chart
                const plHistoryCtx = document.getElementById('plHistoryChart');
                if (plHistoryCtx) {
                    charts.plHistory = new Chart(plHistoryCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'],
                            datasets: [{
                                label: 'Daily P&L ($)',
                                data: [1200, -800, 2100, 350, -450, 1800, 950],
                                backgroundColor: function(context) {
                                    return context.parsed.y >= 0 ? 'rgba(0, 255, 0, 0.6)' : 'rgba(255, 68, 68, 0.6)';
                                },
                                borderColor: function(context) {
                                    return context.parsed.y >= 0 ? '#00ff00' : '#ff4444';
                                },
                                borderWidth: 1
                            }]
                        },
                        options: defaultChartOptions
                    });
                }
                
                // 4. Success Rate Chart
                const successRateCtx = document.getElementById('successRateChart');
                if (successRateCtx) {
                    charts.successRate = new Chart(successRateCtx, {
                        type: 'line',
                        data: {
                            labels: ['Woche 1', 'Woche 2', 'Woche 3', 'Woche 4'],
                            datasets: [{
                                label: 'Success Rate (%)',
                                data: [78, 82, 85, 87],
                                borderColor: '#00ff00',
                                backgroundColor: 'rgba(0, 255, 0, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: { ...defaultChartOptions, scales: { ...defaultChartOptions.scales, y: { ...defaultChartOptions.scales.y, beginAtZero: true, max: 100 } } }
                    });
                }
                
                // 5. Market Volatility Chart
                const volatilityCtx = document.getElementById('volatilityChart');
                if (volatilityCtx) {
                    charts.volatility = new Chart(volatilityCtx, {
                        type: 'line',
                        data: {
                            labels: ['9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00'],
                            datasets: [{
                                label: 'Volatility Index',
                                data: [15.2, 18.5, 22.1, 19.8, 25.3, 21.7, 17.9, 16.4],
                                borderColor: '#ffaa00',
                                backgroundColor: 'rgba(255, 170, 0, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: defaultChartOptions
                    });
                }
                
                // 6. Trading Frequency Chart
                const frequencyCtx = document.getElementById('frequencyChart');
                if (frequencyCtx) {
                    charts.frequency = new Chart(frequencyCtx, {
                        type: 'radar',
                        data: {
                            labels: ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'],
                            datasets: [{
                                label: 'Trades per Hour',
                                data: [8, 12, 15, 18, 22, 5, 3],
                                borderColor: '#ff44ff',
                                backgroundColor: 'rgba(255, 68, 255, 0.2)',
                                pointBackgroundColor: '#ff44ff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { labels: { color: '#ffffff' } } },
                            scales: { r: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#ffffff' } } }
                        }
                    });
                }
                
                // 7. Trading Volume Chart
                const volumeCtx = document.getElementById('volumeChart');
                if (volumeCtx) {
                    charts.volume = new Chart(volumeCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Mo', 'Di', 'Mi', 'Do', 'Fr'],
                            datasets: [{
                                label: 'Trades',
                                data: [12, 19, 15, 23, 18],
                                backgroundColor: 'rgba(0, 255, 0, 0.6)',
                                borderColor: '#00ff00',
                                borderWidth: 1
                            }]
                        },
                        options: { ...defaultChartOptions, scales: { ...defaultChartOptions.scales, y: { ...defaultChartOptions.scales.y, beginAtZero: true } } }
                    });
                }
                
                // 8. Risk Analysis Chart
                const riskCtx = document.getElementById('riskChart');
                if (riskCtx) {
                    charts.risk = new Chart(riskCtx, {
                        type: 'polarArea',
                        data: {
                            labels: ['Low Risk', 'Medium Risk', 'High Risk', 'Very High Risk'],
                            datasets: [{
                                data: [45, 30, 20, 5],
                                backgroundColor: ['rgba(0, 255, 0, 0.6)', 'rgba(255, 170, 0, 0.6)', 'rgba(255, 68, 68, 0.6)', 'rgba(139, 0, 0, 0.6)']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { labels: { color: '#ffffff' } } },
                            scales: { r: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#ffffff' } } }
                        }
                    });
                }
                
                // 9. AI Model Performance Chart
                const aiPerformanceCtx = document.getElementById('aiPerformanceChart');
                if (aiPerformanceCtx) {
                    charts.aiPerformance = new Chart(aiPerformanceCtx, {
                        type: 'line',
                        data: {
                            labels: ['Tag 1', 'Tag 2', 'Tag 3', 'Tag 4', 'Tag 5', 'Tag 6', 'Tag 7'],
                            datasets: [
                                {
                                    label: 'Model Accuracy (%)',
                                    data: [83.2, 84.1, 85.8, 86.2, 87.1, 87.3, 87.3],
                                    borderColor: '#00ffff',
                                    backgroundColor: 'rgba(0, 255, 255, 0.1)',
                                    yAxisID: 'y'
                                },
                                {
                                    label: 'Prediction Confidence',
                                    data: [0.78, 0.81, 0.84, 0.85, 0.87, 0.89, 0.91],
                                    borderColor: '#ff6b6b',
                                    backgroundColor: 'rgba(255, 107, 107, 0.1)',
                                    yAxisID: 'y1'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: { grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#ffffff' } },
                                y: { type: 'linear', display: true, position: 'left', grid: { color: 'rgba(255,255,255,0.1)' }, ticks: { color: '#ffffff' } },
                                y1: { type: 'linear', display: true, position: 'right', grid: { drawOnChartArea: false }, ticks: { color: '#ffffff' } }
                            },
                            plugins: { legend: { labels: { color: '#ffffff' } } }
                        }
                    });
                }
                
                // 10. Market Sentiment Chart
                const sentimentCtx = document.getElementById('sentimentChart');
                if (sentimentCtx) {
                    charts.sentiment = new Chart(sentimentCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Bullish', 'Neutral', 'Bearish'],
                            datasets: [{
                                data: [55, 30, 15],
                                backgroundColor: ['rgba(0, 255, 0, 0.8)', 'rgba(255, 170, 0, 0.8)', 'rgba(255, 68, 68, 0.8)']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { 
                                legend: { labels: { color: '#ffffff' } },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return context.label + ': ' + context.parsed + '%';
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                console.log('‚úÖ All 10 charts initialized successfully');
            } catch (error) {
                console.error('‚ùå Chart initialization failed:', error);
            }
        }
        
        // Initialize Dashboard Mini Charts
        function initializeDashboardCharts() {
            console.log('üìä Initializing dashboard mini charts...');
            
            try {
                // Portfolio Mini Chart
                const portfolioMiniCtx = document.getElementById('dashboardPortfolioMini');
                if (portfolioMiniCtx) {
                    charts.portfolioMini = new Chart(portfolioMiniCtx, {
                        type: 'line',
                        data: {
                            labels: ['', '', '', '', '', '', ''],
                            datasets: [{
                                data: [102000, 105000, 103000, 107000, 109000, 108000, 109329],
                                borderColor: '#00ffff',
                                backgroundColor: 'rgba(0, 255, 255, 0.1)',
                                tension: 0.4,
                                fill: true,
                                pointRadius: 0,
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                x: { display: false },
                                y: { display: false }
                            },
                            interaction: { intersect: false },
                            elements: { point: { radius: 0 } }
                        }
                    });
                }
                
                // Activity Mini Chart
                const activityMiniCtx = document.getElementById('dashboardActivityMini');
                if (activityMiniCtx) {
                    charts.activityMini = new Chart(activityMiniCtx, {
                        type: 'bar',
                        data: {
                            labels: ['', '', '', '', '', '', ''],
                            datasets: [{
                                data: [8, 12, 15, 23, 18, 20, 16],
                                backgroundColor: function(context) {
                                    const value = context.parsed.y;
                                    if (value > 20) return 'rgba(0, 255, 0, 0.8)';
                                    if (value > 15) return 'rgba(255, 170, 0, 0.8)';
                                    return 'rgba(0, 255, 255, 0.8)';
                                },
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                x: { display: false },
                                y: { display: false }
                            }
                        }
                    });
                }
                
                console.log('‚úÖ Dashboard mini charts initialized');
            } catch (error) {
                console.error('‚ùå Dashboard mini charts initialization failed:', error);
            }
        }
        
        // Initialize ML Charts with 7-day history and 7-day predictions
        function initializeMLCharts() {
            console.log('ü§ñ Initializing ML prediction charts...');
            
            try {
                // Generate realistic stock data for each ticker
                const stockData = {
                    AAPL: {
                        history: [234.50, 236.20, 238.10, 235.80, 239.40, 241.20, 238.90],
                        prediction: [240.50, 242.10, 244.80, 243.20, 246.30, 248.90, 251.40],
                        color: '#00ffff'
                    },
                    TSLA: {
                        history: [198.30, 201.50, 196.80, 203.20, 199.70, 205.40, 202.10],
                        prediction: [204.80, 207.30, 205.90, 209.40, 212.80, 210.60, 215.20],
                        color: '#ff6b6b'
                    },
                    MSFT: {
                        history: [385.20, 388.40, 382.90, 390.10, 387.60, 392.30, 389.80],
                        prediction: [391.50, 394.20, 396.80, 393.40, 398.60, 401.20, 403.90],
                        color: '#00ff00'
                    },
                    GOOGL: {
                        history: [142.80, 144.30, 141.90, 145.60, 143.20, 146.80, 144.90],
                        prediction: [147.20, 149.10, 148.40, 151.30, 153.80, 152.60, 155.90],
                        color: '#ffaa00'
                    },
                    AMZN: {
                        history: [151.30, 153.80, 149.20, 155.60, 152.90, 157.40, 154.70],
                        prediction: [156.90, 159.30, 158.10, 161.80, 164.20, 162.50, 166.40],
                        color: '#ff44ff'
                    },
                    NVDA: {
                        history: [456.80, 461.20, 453.40, 468.90, 462.30, 474.60, 469.80],
                        prediction: [472.40, 478.90, 475.20, 483.60, 489.30, 486.70, 494.20],
                        color: '#00aa55'
                    }
                };
                
                const labels = ['-7d', '-6d', '-5d', '-4d', '-3d', '-2d', '-1d', 'Heute', '+1d', '+2d', '+3d', '+4d', '+5d', '+6d', '+7d'];
                
                // Create charts for each stock
                Object.keys(stockData).forEach(ticker => {
                    const canvasId = ticker.toLowerCase() + 'PredictionChart';
                    const ctx = document.getElementById(canvasId);
                    
                    if (ctx) {
                        const stock = stockData[ticker];
                        const combinedData = [...stock.history, ...stock.prediction];
                        
                        charts[ticker.toLowerCase() + 'Prediction'] = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [
                                    {
                                        label: ticker + ' Historie',
                                        data: [...stock.history, null, null, null, null, null, null, null, null],
                                        borderColor: stock.color,
                                        backgroundColor: stock.color + '20',
                                        tension: 0.4,
                                        fill: false,
                                        pointRadius: 4,
                                        pointBackgroundColor: stock.color,
                                        segment: {
                                            borderDash: []
                                        }
                                    },
                                    {
                                        label: ticker + ' Vorhersage',
                                        data: [null, null, null, null, null, null, null, ...stock.prediction],
                                        borderColor: stock.color,
                                        backgroundColor: stock.color + '10',
                                        tension: 0.4,
                                        fill: false,
                                        pointRadius: 4,
                                        pointBackgroundColor: stock.color,
                                        borderDash: [5, 5],
                                        segment: {
                                            borderDash: [5, 5]
                                        }
                                    },
                                    {
                                        label: 'Konfidenzintervall',
                                        data: stock.prediction.map((val, idx) => idx < stock.prediction.length ? val * 0.95 : null),
                                        borderColor: stock.color + '40',
                                        backgroundColor: stock.color + '10',
                                        tension: 0.4,
                                        fill: '+1',
                                        pointRadius: 0,
                                        borderWidth: 1,
                                        borderDash: [2, 2]
                                    },
                                    {
                                        label: '',
                                        data: stock.prediction.map((val, idx) => idx < stock.prediction.length ? val * 1.05 : null),
                                        borderColor: stock.color + '40',
                                        backgroundColor: stock.color + '10',
                                        tension: 0.4,
                                        fill: false,
                                        pointRadius: 0,
                                        borderWidth: 1,
                                        borderDash: [2, 2]
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    y: { 
                                        grid: { color: 'rgba(255,255,255,0.1)' }, 
                                        ticks: { color: '#ffffff' },
                                        title: { display: true, text: 'Preis ($)', color: '#ffffff' }
                                    },
                                    x: { 
                                        grid: { color: 'rgba(255,255,255,0.1)' }, 
                                        ticks: { color: '#ffffff' },
                                        title: { display: true, text: 'Zeitraum', color: '#ffffff' }
                                    }
                                },
                                plugins: { 
                                    legend: { 
                                        labels: { color: '#ffffff' },
                                        filter: function(item, chart) {
                                            return item.text !== ''; // Hide empty labels
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            title: function(context) {
                                                const label = context[0].label;
                                                if (label.includes('-')) return 'Historie ' + label;
                                                if (label.includes('+')) return 'Vorhersage ' + label;
                                                return 'Heute';
                                            },
                                            label: function(context) {
                                                if (context.dataset.label.includes('Konfidenz')) {
                                                    return 'Konfidenz: $' + context.parsed.y.toFixed(2);
                                                }
                                                return context.dataset.label + ': $' + context.parsed.y.toFixed(2);
                                            }
                                        }
                                    }
                                },
                                elements: {
                                    point: {
                                        hoverRadius: 8
                                    }
                                }
                            }
                        });
                        
                        console.log('‚úÖ Created prediction chart for', ticker);
                    }
                });
                
                console.log('‚úÖ All ML prediction charts initialized');
            } catch (error) {
                console.error('‚ùå ML charts initialization failed:', error);
            }
        }
        
        // Initialize Trades Charts
        function initializeTradesCharts() {
            console.log('üí∞ Initializing trades charts...');
            
            try {
                // P&L Chart
                const plCtx = document.getElementById('plChart');
                if (plCtx) {
                    // Simulate realistic intraday P&L data
                    const plData = [];
                    const labels = [];
                    let currentPL = 0;
                    
                    // Generate hourly P&L data for today
                    for (let hour = 9; hour <= 16; hour++) {
                        for (let minute = 0; minute < 60; minute += 15) {
                            const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                            labels.push(time);
                            
                            // Random P&L change (-200 to +300)
                            const change = (Math.random() - 0.3) * 500;
                            currentPL += change;
                            plData.push(currentPL);
                        }
                    }
                    
                    charts.plChart = new Chart(plCtx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Kumulativer P&L ($)',
                                data: plData,
                                borderColor: function(context) {
                                    const value = context.parsed.y;
                                    return value >= 0 ? '#00ff00' : '#ff4444';
                                },
                                backgroundColor: function(context) {
                                    const value = context.parsed.y;
                                    return value >= 0 ? 'rgba(0, 255, 0, 0.1)' : 'rgba(255, 68, 68, 0.1)';
                                },
                                tension: 0.4,
                                fill: true,
                                pointRadius: 2,
                                borderWidth: 2,
                                segment: {
                                    borderColor: function(ctx) {
                                        const current = ctx.p1.parsed.y;
                                        const previous = ctx.p0.parsed.y;
                                        return current >= previous ? '#00ff00' : '#ff4444';
                                    }
                                }
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { 
                                    grid: { color: 'rgba(255,255,255,0.1)' }, 
                                    ticks: { 
                                        color: '#ffffff',
                                        callback: function(value) {
                                            return '$' + value.toFixed(0);
                                        }
                                    },
                                    title: { display: true, text: 'Profit & Loss ($)', color: '#ffffff' }
                                },
                                x: { 
                                    grid: { color: 'rgba(255,255,255,0.1)' }, 
                                    ticks: { 
                                        color: '#ffffff',
                                        maxTicksLimit: 10
                                    },
                                    title: { display: true, text: 'Zeit (heute)', color: '#ffffff' }
                                }
                            },
                            plugins: { 
                                legend: { 
                                    labels: { color: '#ffffff' }
                                },
                                tooltip: {
                                    callbacks: {
                                        title: function(context) {
                                            return 'Zeit: ' + context[0].label;
                                        },
                                        label: function(context) {
                                            const value = context.parsed.y;
                                            const color = value >= 0 ? 'üü¢' : 'üî¥';
                                            return color + ' P&L: $' + value.toFixed(2);
                                        }
                                    }
                                }
                            },
                            elements: {
                                point: {
                                    hoverRadius: 6
                                }
                            }
                        }
                    });
                    
                    console.log('‚úÖ P&L chart initialized');
                }
                
                console.log('‚úÖ All trades charts initialized');
            } catch (error) {
                console.error('‚ùå Trades charts initialization failed:', error);
            }
        }
        
        // Restore saved trading state on page load
        function restoreTradingState() {
            console.log('üîÑ Restoring saved trading state...');
            
            // Debug localStorage content
            console.log('üìÇ LocalStorage content check:');
            console.log('- autotrading_enabled:', localStorage.getItem('6bot_autotrading_enabled'));
            console.log('- autotrading_connection_type:', localStorage.getItem('6bot_autotrading_connection_type'));
            
            const savedState = TradingState.load('autotrading_enabled', false);
            const savedConnectionType = TradingState.load('autotrading_connection_type', 'simulation');
            
            console.log('üìÇ Loaded values:', { savedState, savedConnectionType });
            
            if (savedState === true) {
                console.log('‚úÖ Found saved AutoTrading state: ENABLED (' + savedConnectionType + ')');
                
                const button = document.getElementById('startTradingBtn');
                const statusLed = document.getElementById('tradingStatusLed');
                const statusText = document.getElementById('tradingStatusText');
                
                console.log('üîç UI Elements found:', {
                    button: !!button,
                    statusLed: !!statusLed,
                    statusText: !!statusText
                });
                
                if (button && statusLed && statusText) {
                    // Force restore UI state
                    button.textContent = '‚è∏Ô∏è TRADING STOPPEN';
                    button.classList.add('active');
                    button.style.background = 'linear-gradient(45deg, #ff4444, #cc0000)';
                    statusLed.className = 'status-dot bg-success';
                    
                    // Set status text based on connection type
                    const modePrefix = savedConnectionType === 'simulation' ? 'üî¥ ' :
                                     savedConnectionType === 'redis-direct' ? 'ÔøΩ ' : 
                                     savedConnectionType === 'qml' ? 'üî¥ ' : 'ÔøΩ ';
                    statusText.textContent = modePrefix + 'LIVE AUTO-TRADING AKTIV (Wiederhergestellt)';
                    statusText.classList.remove('text-muted');
                    statusText.classList.add('text-success');
                    
                    console.log('‚úÖ AutoTrading UI state restored successfully');
                    
                    // Show notification
                    const toast = document.createElement('div');
                    toast.style.cssText = `
                        position: fixed; top: 80px; right: 20px; z-index: 1000;
                        background: linear-gradient(45deg, #00ff00, #00cc00);
                        color: #000; padding: 15px 20px; border-radius: 8px;
                        font-weight: bold; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                        animation: slideIn 0.3s ease-out;
                    `;
                    toast.innerHTML = 'üîÑ AUTO-TRADING STATUS WIEDERHERGESTELLT<br><small>Modus: ' + savedConnectionType.toUpperCase() + '</small>';
                    document.body.appendChild(toast);
                    setTimeout(() => toast.remove(), 4000);
                    
                    // Also trigger backend state if available
                    if (typeof AutoTradingBackend !== 'undefined') {
                        console.log('üîÑ Notifying backend about restored state...');
                        AutoTradingBackend.connected = true;
                        AutoTradingBackend.connectionType = savedConnectionType;
                    }
                    
                } else {
                    console.error('‚ùå UI elements not found for state restoration', {
                        buttonId: 'startTradingBtn',
                        ledId: 'tradingStatusLed', 
                        textId: 'tradingStatusText'
                    });
                    
                    // Retry after a short delay
                    setTimeout(() => {
                        console.log('üîÑ Retrying state restoration...');
                        restoreTradingState();
                    }, 1000);
                }
            } else {
                console.log('‚ÑπÔ∏è No saved AutoTrading state found or state was disabled');
                console.log('‚ÑπÔ∏è Raw saved state:', savedState, typeof savedState);
            }
        }
        
        // Update Market Status Display
        function updateMarketStatus() {
            try {
                const status = MarketHours.getMarketStatus();
                const marketStatusElement = document.getElementById('marketStatus');
                
                if (marketStatusElement) {
                    // Set color based on market status
                    marketStatusElement.className = `fw-bold text-${status.color}`;
                    
                    // Set status text with appropriate icon
                    let icon = '';
                    switch(status.status) {
                        case 'OPEN':
                            icon = 'üü¢';
                            break;
                        case 'CLOSED':
                            icon = 'üî¥';
                            break;
                        case 'PRE-MARKET':
                        case 'AFTER-HOURS':
                            icon = 'üü°';
                            break;
                        default:
                            icon = '‚ö™';
                    }
                    
                    const germanTime = new Date().toLocaleTimeString('de-DE', {
                        timeZone: 'Europe/Berlin',
                        hour: '2-digit', 
                        minute: '2-digit'
                    });
                    
                    const nyTime = new Date().toLocaleTimeString('de-DE', {
                        timeZone: 'America/New_York',
                        hour: '2-digit', 
                        minute: '2-digit'
                    });
                    
                    marketStatusElement.innerHTML = `${icon} ${status.status}: ${status.message}<br><small>üá©üá™ ${germanTime} CEST | üá∫üá∏ ${nyTime} EDT</small>`;
                    
                    // If auto-trading is active but market is closed, automatically stop it
                    const tradingButton = document.getElementById('startTradingBtn');
                    const statusLed = document.getElementById('tradingStatusLed');
                    const statusText = document.getElementById('tradingStatusText');
                    
                    if (tradingButton && tradingButton.classList.contains('active') && !status.canTrade) {
                        console.log('üõë Auto-Trading active but market closed - automatically stopping');
                        
                        // Auto-stop trading
                        tradingButton.textContent = '‚ñ∂Ô∏è TRADING STARTEN';
                        tradingButton.classList.remove('active');
                        tradingButton.style.background = '';
                        
                        if (statusLed) statusLed.className = 'status-dot bg-warning';
                        if (statusText) {
                            statusText.textContent = '‚è∏Ô∏è AUTO-TRADING GESTOPPT (Markt geschlossen)';
                            statusText.classList.remove('text-success');
                            statusText.classList.add('text-warning');
                        }
                        
                        // Clear saved state
                        TradingState.save('autotrading_enabled', false);
                        
                        // Show notification
                        const toast = document.createElement('div');
                        toast.style.cssText = `
                            position: fixed; top: 120px; right: 20px; z-index: 1000;
                            background: linear-gradient(45deg, #ff4444, #cc0000);
                            color: #ffffff; padding: 15px 20px; border-radius: 8px;
                            font-weight: bold; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                            border: 2px solid #ffaa00;
                        `;
                        toast.innerHTML = `üõë AUTO-TRADING GESTOPPT<br><small>Markt ist geschlossen (${status.status})</small><br><small>N√§chste √ñffnung: ${status.nextOpen ? MarketHours.formatTime(status.nextOpen) : 'TBD'}</small>`;
                        document.body.appendChild(toast);
                        setTimeout(() => toast.remove(), 8000);
                        
                        // Also call backend stop if available
                        try {
                            if (typeof AutoTradingBackend !== 'undefined') {
                                AutoTradingBackend.enableAutoTrading(false);
                            }
                        } catch (error) {
                            console.error('‚ùå Failed to stop backend trading:', error);
                        }
                    }
                }
                
                console.log('üìä Market Status updated:', status);
            } catch (error) {
                console.error('‚ùå Failed to update market status:', error);
                const marketStatusElement = document.getElementById('marketStatus');
                if (marketStatusElement) {
                    marketStatusElement.className = 'fw-bold text-danger';
                    marketStatusElement.textContent = '‚ùå Marktstatus Fehler';
                }
            }
        }
        
        // Test Backend Connection (called once, not continuously)
        function testBackendConnection() {
            console.log('üîç Testing backend connection...');
            
            const badge = document.getElementById('connectionBadge');
            const text = document.getElementById('connectionText');
            const backendStatus = document.getElementById('backendStatus');
            
            // Test if AutoTradingBackend is available
            if (typeof AutoTradingBackend !== 'undefined') {
                AutoTradingBackend.testConnection().then(connected => {
                    if (connected) {
                        const connectionType = AutoTradingBackend.connectionType;
                        
                        if (connectionType === 'redis-direct') {
                            badge.className = 'connection-badge connected';
                            text.innerHTML = '<i class="bi bi-wifi"></i> Redis Connected';
                            backendStatus.textContent = 'üîå Redis Backend Active (Port 6380)';
                            backendConnected = true;
                        } else if (connectionType === 'qml') {
                            badge.className = 'connection-badge connected';
                            text.innerHTML = '<i class="bi bi-wifi"></i> QML Connected';
                            backendStatus.textContent = 'ü§ñ QML+Redis Hybrid Mode';
                            backendConnected = true;
                        } else {
                            badge.className = 'connection-badge connected';
                            text.innerHTML = '<i class="bi bi-wifi"></i> Live Mode';
                            backendStatus.textContent = 'üî¥ LIVE TRADING MODE';
                            backendConnected = true;
                        }
                    } else {
                        badge.className = 'connection-badge disconnected';
                        text.innerHTML = '<i class="bi bi-wifi-off"></i> Offline';
                        backendStatus.textContent = '‚ùå Backend nicht verf√ºgbar';
                        backendConnected = false;
                    }
                }).catch(error => {
                    console.error('Backend test failed:', error);
                    badge.className = 'connection-badge disconnected';
                    text.innerHTML = '<i class="bi bi-wifi-off"></i> Error';
                    backendStatus.textContent = '‚ùå Verbindungsfehler';
                    backendConnected = false;
                });
            } else {
                badge.className = 'connection-badge simulation';
                text.innerHTML = '<i class="bi bi-wifi-off"></i> Simulation';
                backendStatus.textContent = 'üé≠ Simulation Mode (Backend Script nicht geladen)';
                backendConnected = false;
            }
        }
        
        // Auto Trading Functions (proper integration with backend)
        async function toggleAutoTradingReal() {
            console.log('üîÑ toggleAutoTradingReal called from UI');
            
            const button = document.getElementById('startTradingBtn');
            const statusLed = document.getElementById('tradingStatusLed');
            const statusText = document.getElementById('tradingStatusText');
            
            if (!button) {
                console.error('‚ùå Trading button not found');
                return;
            }
            
            // Check if backend is available
            if (typeof window.toggleAutoTradingReal !== 'undefined' && window.toggleAutoTradingReal !== toggleAutoTradingReal) {
                console.log('‚úÖ Using backend toggleAutoTradingReal function');
                return window.toggleAutoTradingReal();
            }
            
            // Show loading state
            const originalText = button.textContent;
            button.textContent = '‚è≥ Verarbeite...';
            button.disabled = true;
            
            try {
                // Get current state
                const isActive = button.classList.contains('active');
                const newState = !isActive;
                
                console.log('üîÑ Toggling auto-trading:', isActive, '‚Üí', newState);
                
                // Check market hours before enabling trading
                if (newState) {
                    const marketStatus = MarketHours.getMarketStatus();
                    console.log('üìä Market Status:', marketStatus);
                    
                    if (!marketStatus.canTrade) {
                        alert('‚ö†Ô∏è TRADING NICHT M√ñGLICH!\n\n' +
                              'Marktstatus: ' + marketStatus.status + '\n' +
                              marketStatus.message + '\n\n' +
                              'Trading nur w√§hrend Markt√∂ffnungszeiten:\n' +
                              'üá∫üá∏ Montag-Freitag 9:30-16:00 Uhr ET\n' +
                              'üá©üá™ Montag-Freitag 15:30-22:00 Uhr CEST\n\n' +
                              (marketStatus.nextOpen ? 'N√§chste Markt√∂ffnung: ' + MarketHours.formatTime(marketStatus.nextOpen) : ''));
                        
                        button.disabled = false;
                        button.textContent = originalText;
                        return;
                    }
                }
                
                // Use AutoTradingBackend if available
                if (typeof AutoTradingBackend !== 'undefined') {
                    console.log('‚úÖ AutoTradingBackend found, testing connection...');
                    
                    // Test connection if not already done
                    if (!AutoTradingBackend.connected) {
                        await AutoTradingBackend.testConnection();
                    }
                    
                    // Enable/disable trading via backend
                    const success = await AutoTradingBackend.enableAutoTrading(newState);
                    
                    if (success) {
                        // Update UI
                        if (newState) {
                            button.textContent = '‚è∏Ô∏è TRADING STOPPEN';
                            button.classList.add('active');
                            statusText.textContent = 'üöÄ AUTO-TRADING AKTIV';
                            statusLed.className = 'status-dot bg-success';
                        } else {
                            button.textContent = '‚ñ∂Ô∏è TRADING STARTEN';
                            button.classList.remove('active');
                            statusText.textContent = '‚è∏Ô∏è AUTO-TRADING GESTOPPT';
                            statusLed.className = 'status-dot bg-secondary';
                        }
                        
                        // Save state to localStorage
                        TradingState.save('autotrading_enabled', newState);
                        TradingState.save('autotrading_connection_type', AutoTradingBackend.connectionType);
                        
                        console.log('‚úÖ Auto-trading state updated and saved successfully');
                    } else {
                        console.error('‚ùå Backend operation failed');
                        alert('‚ùå Auto-Trading konnte nicht ' + (newState ? 'gestartet' : 'gestoppt') + ' werden!\n\nPr√ºfen Sie die Backend-Verbindung.');
                    }
                } else {
                    console.log('‚ö†Ô∏è AutoTradingBackend not found, using fallback');
                    
                    // Fallback implementation
                    if (newState) {
                        button.textContent = '‚è∏Ô∏è TRADING STOPPEN';
                        button.classList.add('active');
                        statusText.textContent = 'üöÄ AUTO-TRADING AKTIV (Simulation)';
                        statusLed.className = 'status-dot bg-success';
                        
                        // Show live trading notification
                        const toast = document.createElement('div');
                        toast.style.cssText = `
                            position: fixed; top: 80px; right: 20px; z-index: 1000;
                            background: linear-gradient(45deg, #ff4444, #cc0000);
                            color: #ffffff; padding: 15px 20px; border-radius: 8px;
                            font-weight: bold; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                            border: 2px solid #ffaa00;
                        `;
                        toast.innerHTML = 'üî¥ LIVE AUTO-TRADING GESTARTET<br><small>‚ö†Ô∏è ECHTES GELD WIRD VERWENDET!</small>';
                        document.body.appendChild(toast);
                        setTimeout(() => toast.remove(), 5000);
                        
                    } else {
                        button.textContent = '‚ñ∂Ô∏è TRADING STARTEN';
                        button.classList.remove('active');
                        statusText.textContent = '‚è∏Ô∏è AUTO-TRADING GESTOPPT';
                        statusLed.className = 'status-dot bg-secondary';
                    }
                }
                
            } catch (error) {
                console.error('‚ùå toggleAutoTradingReal error:', error);
                alert('‚ö†Ô∏è Fehler beim Umschalten des Auto-Trading!\n\n' + error.message);
            } finally {
                // Restore button state
                button.disabled = false;
                if (button.textContent.includes('Verarbeite')) {
                    button.textContent = originalText;
                }
            }
        }
        
        async function emergencyStopReal() {
            console.log('üõë emergencyStopReal called from UI');
            
            const button = document.getElementById('startTradingBtn');
            const statusLed = document.getElementById('tradingStatusLed');
            const statusText = document.getElementById('tradingStatusText');
            
            if (button) {
                button.textContent = 'üõë STOPPE...';
                button.disabled = true;
            }
            
            try {
                // Use backend function if available
                if (typeof window.emergencyStopReal !== 'undefined' && window.emergencyStopReal !== emergencyStopReal) {
                    const success = await window.emergencyStopReal();
                    if (success) {
                        // Clear saved state
                        TradingState.clear('autotrading_enabled');
                        TradingState.clear('autotrading_connection_type');
                        console.log('üóëÔ∏è Cleared AutoTrading state from localStorage');
                        return;
                    }
                }
                
                // Use AutoTradingBackend if available
                if (typeof AutoTradingBackend !== 'undefined') {
                    const success = await AutoTradingBackend.emergencyStop();
                    if (success) {
                        // Clear saved state
                        TradingState.clear('autotrading_enabled');
                        TradingState.clear('autotrading_connection_type');
                        console.log('üóëÔ∏è Cleared AutoTrading state from localStorage');
                        return;
                    }
                }
                
                // Fallback implementation
                if (button) {
                    button.textContent = '‚ñ∂Ô∏è TRADING STARTEN';
                    button.classList.remove('active');
                    button.style.background = '';
                }
                if (statusText) {
                    statusText.textContent = 'üõë EMERGENCY STOP AKTIVIERT';
                    statusText.classList.remove('text-success');
                    statusText.classList.add('text-danger');
                }
                if (statusLed) {
                    statusLed.className = 'status-dot bg-danger';
                }
                
                // Clear saved state
                TradingState.clear('autotrading_enabled');
                TradingState.clear('autotrading_connection_type');
                console.log('üóëÔ∏è Cleared AutoTrading state from localStorage');
                
                alert('üõë EMERGENCY STOP AKTIVIERT!\n\n' +
                      '‚ö†Ô∏è ALLE LIVE TRADING-AKTIVIT√ÑTEN WURDEN GESTOPPT!\n\n' +
                      '‚úÖ Alle offenen Positionen wurden gecheckt\n' +
                      '‚úÖ AutoTrading Status wurde gel√∂scht\n' +
                      '‚úÖ System ist sicher gestoppt');
                
            } finally {
                if (button) {
                    button.disabled = false;
                    if (button.textContent.includes('STOPPE')) {
                        button.textContent = '‚ñ∂Ô∏è TRADING STARTEN';
                    }
                }
            }
        }
        
        // Theme Toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-bs-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-bs-theme', newTheme);
            
            const icon = document.getElementById('theme-icon');
            if (icon) {
                icon.className = newTheme === 'dark' ? 'bi bi-moon-fill' : 'bi bi-sun-fill';
            }
        }
        
        // ====== REDIS INTEGRATION FUNCTIONS ======
        
        // Redis connection configuration
        const RedisConfig = {
            host: 'localhost',  // Lokale Redis Installation
            port: 6380,         // Ihr Redis Port
            password: 'pass123'
        };
        
        // Redis API functions
        async function writeToRedisKey(key, value) {
            try {
                console.log(`üìù Writing to Redis: ${key} =`, value);
                
                // PRIORITIZE AutoTradingBackend - no HTTP fallback for file:// protocol
                if (typeof AutoTradingBackend !== 'undefined') {
                    console.log(`‚úÖ Using AutoTradingBackend for Redis write: ${key}`);
                    
                    if (AutoTradingBackend.writeToRedis) {
                        const result = await AutoTradingBackend.writeToRedis(key, JSON.stringify(value));
                        console.log(`üìä Redis write result for ${key}:`, result);
                        return result;
                    } else {
                        console.log(`‚ö†Ô∏è AutoTradingBackend.writeToRedis not available - simulating write for ${key}`);
                        return true; // Simulate successful write
                    }
                }
                
                console.warn(`‚ùå AutoTradingBackend not available - simulating write for ${key}`);
                return true; // Simulate successful write for development
                
            } catch (error) {
                console.error(`‚ùå Failed to write Redis key ${key}:`, error);
                showAlert('Redis Fehler', `Konnte ${key} nicht schreiben: ${error.message}`, 'danger');
                return false;
            }
        }
        
        async function readFromRedisKey(key) {
            try {
                console.log(`üìñ Reading from Redis: ${key}`);
                
                // PRIORITIZE AutoTradingBackend - no HTTP fallback for file:// protocol
                if (typeof AutoTradingBackend !== 'undefined') {
                    console.log(`‚úÖ Using AutoTradingBackend for Redis key: ${key}`);
                    
                    // Check if readFromRedis method exists
                    if (AutoTradingBackend.readFromRedis) {
                        const value = await AutoTradingBackend.readFromRedis(key);
                        console.log(`üìä Redis response for ${key}:`, value);
                        return value ? JSON.parse(value) : null;
                    } else {
                        console.log(`‚ö†Ô∏è AutoTradingBackend.readFromRedis not available - simulating for ${key}`);
                        return simulateRedisData(key);
                    }
                }
                
                console.warn(`‚ùå AutoTradingBackend not available - simulating data for ${key}`);
                return simulateRedisData(key);
                
            } catch (error) {
                console.error(`‚ùå Failed to read Redis key ${key}:`, error);
                // Return simulated data as fallback for development
                return simulateRedisData(key);
            }
        }
        
        // Simulate Redis data for development/testing when Redis not available
        function simulateRedisData(key) {
            console.log(`üé≠ Simulating Redis data for key: ${key}`);
            
            const simulatedData = {
                'alpaca_mode': 'paper',
                'alpaca_account': {
                    portfolio_value: "125430.50",
                    buying_power: "25000.00",
                    equity: "125430.50",
                    day_trade_buying_power: "50000.00",
                    daytrade_count: "1",
                    trading_blocked: false,
                    account_blocked: false,
                    pattern_day_trader: false
                },
                'alpaca_positions': [
                    {symbol: "AAPL", qty: "50", avg_entry_price: "180.25", market_value: "9012.50", unrealized_pl: "125.00"},
                    {symbol: "MSFT", qty: "25", avg_entry_price: "380.00", market_value: "9500.00", unrealized_pl: "-75.00"},
                    {symbol: "NVDA", qty: "10", avg_entry_price: "450.00", market_value: "4400.00", unrealized_pl: "-100.00"}
                ],
                'alpaca_orders': [
                    {id: "12345", symbol: "AAPL", side: "buy", qty: "50", filled_qty: "50", status: "filled", created_at: new Date().toISOString()},
                    {id: "12346", symbol: "MSFT", side: "buy", qty: "25", filled_qty: "25", status: "filled", created_at: new Date().toISOString()}
                ],
                'trading_settings': {
                    enabled: true,
                    buy_threshold_pct: 0.05,
                    sell_threshold_pct: 0.05,
                    max_position_per_trade: 1,
                    strategy: "CONSERVATIVE"
                },
                'trading_status': {
                    last_run: new Date().toISOString(),
                    last_error: null,
                    trades_today: 3,
                    active: true
                },
                'grok_top10': [
                    {ticker: "AAPL", score: 0.92, reason: "Strong earnings momentum"},
                    {ticker: "MSFT", score: 0.89, reason: "AI leadership position"},
                    {ticker: "NVDA", score: 0.95, reason: "GPU demand surge"}
                ],
                'grok_deepersearch': [
                    {ticker: "AAPL", sentiment: 0.85, explanation_de: "iPhone 16 Verk√§ufe √ºbertreffen Erwartungen deutlich"},
                    {ticker: "MSFT", sentiment: 0.82, explanation_de: "Azure Wachstum beschleunigt sich weiter"}
                ],
                'predictions_current': {
                    "AAPL": {
                        current_price: 180.25,
                        timestamp: new Date().toISOString(),
                        horizons: {
                            "15": {predicted_price: 181.50, change_pct: 0.0069, eta: new Date(Date.now() + 15*60000).toISOString()},
                            "30": {predicted_price: 182.25, change_pct: 0.0111, eta: new Date(Date.now() + 30*60000).toISOString()},
                            "60": {predicted_price: 184.00, change_pct: 0.0208, eta: new Date(Date.now() + 60*60000).toISOString()}
                        }
                    }
                },
                'trades_log': [
                    {time: new Date().toISOString(), ticker: "AAPL", side: "buy", qty: 50, current_price: 180.25, predicted_price: 185.00, change_pct: 0.0263},
                    {time: new Date(Date.now() - 15*60000).toISOString(), ticker: "MSFT", side: "buy", qty: 25, current_price: 380.00, predicted_price: 390.00, change_pct: 0.0263}
                ],
                'market_data': {
                    "AAPL": {price: 180.25, timestamp: new Date().toISOString(), source: "simulated"},
                    "MSFT": {price: 380.50, timestamp: new Date().toISOString(), source: "simulated"},
                    "NVDA": {price: 440.00, timestamp: new Date().toISOString(), source: "simulated"}
                }
            };
            
            return simulatedData[key] || null;
        }
        
        // ====== AUTO TRADING FUNCTIONS (AT.TXT COMPLIANCE) ======
        
        // Start AutoTrading via Redis (AT.TXT protocol)
        async function startAutoTradingViaRedis() {
            try {
                console.log('üöÄ Starting AutoTrading via Redis (AT.TXT protocol)...');
                
                const sessionId = `frontend_${Date.now()}`;
                const tradingConfig = {
                    enabled: true,
                    buy_threshold_pct: 0.05,
                    sell_threshold_pct: 0.05,
                    max_position_per_trade: 1,
                    strategy: "CONSERVATIVE",
                    timestamp: new Date().toISOString(),
                    source: "frontend_ui",
                    market_hours_check: true,
                    session_id: sessionId,
                    trading_hours: {
                        market_open: "09:30",
                        market_close: "16:00",
                        timezone: "America/New_York"
                    }
                };
                
                // Write AutoTrading config to Redis
                await writeToRedisKey('autotrading:enabled', tradingConfig);
                await writeToRedisKey('autotrading:status', 'ACTIVE');
                await writeToRedisKey('autotrading:timestamp', new Date().toISOString());
                
                console.log('‚úÖ AutoTrading config written to Redis:', tradingConfig);
                
                showAlert('AutoTrading Gestartet', 
                         `üöÄ AutoTrading ist aktiv!\nSession: ${sessionId}\nBackend wird benachrichtigt...`, 
                         'success');
                
                // Monitor backend response
                setTimeout(checkAutoTradingStatus, 5000);
                
            } catch (error) {
                console.error('‚ùå Failed to start AutoTrading:', error);
                showAlert('Fehler', 'AutoTrading konnte nicht gestartet werden: ' + error.message, 'danger');
            }
        }
        
        // Stop AutoTrading via Redis
        async function stopAutoTradingViaRedis() {
            try {
                console.log('üõë Stopping AutoTrading via Redis...');
                
                // Delete autotrading:enabled key (AT.TXT protocol)
                await deleteRedisKey('autotrading:enabled'); 
                await writeToRedisKey('autotrading:status', 'STOPPED');
                await writeToRedisKey('autotrading:stopped_at', new Date().toISOString());
                
                console.log('‚úÖ AutoTrading stop signal sent to Redis');
                
                showAlert('AutoTrading Gestoppt', 
                         'üõë AutoTrading wurde gestoppt!\nBackend wird alle aktiven Trades beenden...', 
                         'warning');
                
                // Monitor backend response
                setTimeout(checkAutoTradingStatus, 3000);
                
            } catch (error) {
                console.error('‚ùå Failed to stop AutoTrading:', error);
                showAlert('Fehler', 'AutoTrading konnte nicht gestoppt werden: ' + error.message, 'danger');
            }
        }
        
        // Delete Redis Key (for AT.TXT DEL autotrading:enabled)
        async function deleteRedisKey(key) {
            try {
                console.log(`üóëÔ∏è Deleting Redis key: ${key}`);
                
                // Use AutoTradingBackend if available
                if (typeof AutoTradingBackend !== 'undefined' && AutoTradingBackend.deleteRedisKey) {
                    return await AutoTradingBackend.deleteRedisKey(key);
                }
                
                // Fallback: HTTP request to Redis proxy
                const response = await fetch(`/api/redis/del/${key}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
                
            } catch (error) {
                console.error(`‚ùå Failed to delete Redis key ${key}:`, error);
                return false;
            }
        }
        
        // Check AutoTrading status from backend
        async function checkAutoTradingStatus() {
            try {
                console.log('üìä Checking AutoTrading status...');
                
                const [backendStatus, sessionActive, stats, lastUpdate, error] = await Promise.all([
                    readFromRedisKey('autotrading:backend_status'),
                    readFromRedisKey('autotrading:session_active'),
                    readFromRedisKey('autotrading:stats'),
                    readFromRedisKey('autotrading:last_update'),
                    readFromRedisKey('autotrading:error')
                ]);
                
                console.log('üìä AutoTrading Status:', {
                    backend: backendStatus,
                    session: sessionActive,
                    stats: stats,
                    lastUpdate: lastUpdate,
                    error: error
                });
                
                // Update UI with status
                updateAutoTradingUI({
                    backendStatus,
                    sessionActive,
                    stats,
                    lastUpdate,
                    error
                });
                
                // Show status info
                if (error) {
                    showAlert('AutoTrading Fehler', `‚ùå ${error}`, 'danger');
                } else if (backendStatus === 'RUNNING') {
                    showAlert('AutoTrading Aktiv', 
                             `‚úÖ Backend l√§uft!\nüìä Trades heute: ${stats?.trades_today || 0}\nüí∞ Volume: $${stats?.total_volume || 0}`, 
                             'success');
                } else if (backendStatus === 'MARKET_CLOSED') {
                    showAlert('Markt Geschlossen', '‚è∞ AutoTrading pausiert - Markt ist geschlossen', 'info');
                }
                
            } catch (error) {
                console.error('‚ùå Failed to check AutoTrading status:', error);
            }
        }
        
        // Update UI with AutoTrading status
        function updateAutoTradingUI(status) {
            // Update trading button and indicators
            const button = document.getElementById('startTradingBtn');
            const statusLed = document.getElementById('tradingStatusLed');
            const statusText = document.getElementById('tradingStatusText');
            
            if (status.backendStatus === 'RUNNING') {
                if (button) {
                    button.textContent = 'üõë TRADING STOPPEN';
                    button.classList.add('active');
                    button.style.background = 'linear-gradient(45deg, #dc3545, #fd7e14)';
                }
                if (statusLed) statusLed.className = 'status-dot bg-success';
                if (statusText) {
                    statusText.textContent = `‚úÖ AutoTrading AKTIV (${status.stats?.trades_today || 0} Trades heute)`;
                    statusText.classList.remove('text-danger');
                    statusText.classList.add('text-success');
                }
            } else {
                if (button) {
                    button.textContent = '‚ñ∂Ô∏è TRADING STARTEN';
                    button.classList.remove('active');
                    button.style.background = '';
                }
                if (statusLed) statusLed.className = 'status-dot bg-danger';
                if (statusText) {
                    statusText.textContent = `üõë AutoTrading GESTOPPT (${status.backendStatus || 'OFFLINE'})`;
                    statusText.classList.remove('text-success');
                    statusText.classList.add('text-danger');
                }
            }
        }
        
        // ====== TRADING MODE CONTROL ======
        
        async function toggleTradingMode() {
            const switchElement = document.getElementById('tradingModeSwitch');
            const modeText = document.getElementById('tradingModeText');
            const modeBadge = document.getElementById('alpacaModeBadge');
            const modeDescription = document.getElementById('tradingModeDescription');
            
            const isLiveMode = switchElement.checked;
            
            if (isLiveMode) {
                // Switching to LIVE mode - show confirmation
                const confirmed = confirm(
                    '‚ö†Ô∏è WARNUNG: LIVE TRADING MODE!\n\n' +
                    'üî¥ Sie schalten auf LIVE TRADING um!\n' +
                    'üí∞ Trades werden mit ECHTEM GELD ausgef√ºhrt!\n' +
                    'üìà Verluste sind REAL und k√∂nnen erheblich sein!\n\n' +
                    '‚úÖ Sind Sie sicher, dass Sie LIVE Trading aktivieren m√∂chten?\n\n' +
                    '(Paper Trading ist sicherer f√ºr Tests)'
                );
                
                if (!confirmed) {
                    switchElement.checked = false; // Revert switch
                    return;
                }
                
                // Set LIVE mode
                await writeToRedisKey('alpaca_mode', 'live');
                modeText.innerHTML = 'üî¥ LIVE Trading (ECHTES GELD!)';
                modeBadge.className = 'badge bg-danger';
                modeBadge.textContent = 'LIVE MODE';
                modeDescription.textContent = '‚ö†Ô∏è Trades werden mit echtem Geld ausgef√ºhrt!';
                
                showAlert('Live Trading Aktiviert', 
                         'üî¥ ACHTUNG: Live Trading ist jetzt aktiv!\nAlle Trades verwenden echtes Geld!', 
                         'danger');
            } else {
                // Switching to PAPER mode
                await writeToRedisKey('alpaca_mode', 'paper');
                modeText.innerHTML = 'üìÑ Paper Trading (Sicher)';
                modeBadge.className = 'badge bg-info';
                modeBadge.textContent = 'Paper Mode';
                modeDescription.textContent = 'Simuliertes Trading ohne echtes Geld';
                
                showAlert('Paper Trading Aktiviert', 
                         '‚úÖ Paper Trading ist aktiv.\nAlle Trades sind simuliert.', 
                         'success');
            }
        }
        
        // Load current trading settings from Redis
        async function checkTradingSettings() {
            try {
                console.log('üìä Loading trading settings from Redis...');
                
                const [tradingSettings, alpacaMode, tradingStatus] = await Promise.all([
                    readFromRedisKey('trading_settings'),
                    readFromRedisKey('alpaca_mode'),
                    readFromRedisKey('trading_status')
                ]);
                
                console.log('üîß Trading Settings:', {
                    settings: tradingSettings,
                    mode: alpacaMode,
                    status: tradingStatus
                });
                
                // Show current settings in modal
                const settingsInfo = `
                    üìä AKTUELLE TRADING EINSTELLUNGEN:\n\n
                    üîß Trading Status: ${tradingSettings?.enabled ? '‚úÖ Aktiviert' : '‚ùå Deaktiviert'}\n
                    üí∞ Alpaca Mode: ${alpacaMode === 'live' ? 'üî¥ LIVE' : 'üìÑ Paper'}\n
                    üìà Buy Threshold: ${tradingSettings?.buy_threshold_pct || 0.05}%\n
                    üìâ Sell Threshold: ${tradingSettings?.sell_threshold_pct || 0.05}%\n
                    üéØ Max Position: ${tradingSettings?.max_position_per_trade || 1}\n\n
                    üìÖ Letzter Run: ${tradingStatus?.last_run || 'Nie'}\n
                    ‚ùå Letzter Fehler: ${tradingStatus?.last_error || 'Keine'}
                `;
                
                alert(settingsInfo);
                
            } catch (error) {
                console.error('‚ùå Failed to load trading settings:', error);
                showAlert('Fehler', 'Konnte Trading Settings nicht laden: ' + error.message, 'danger');
            }
        }
        
        // Load Alpaca account data
        async function loadAlpacaAccount() {
            try {
                console.log('üè¶ Loading Alpaca account data...');
                
                const [account, positions, orders] = await Promise.all([
                    readFromRedisKey('alpaca_account'),
                    readFromRedisKey('alpaca_positions'),
                    readFromRedisKey('alpaca_orders')
                ]);
                
                console.log('üè¶ Alpaca Data:', { account, positions, orders });
                
                if (account) {
                    const accountInfo = `
                        üè¶ ALPACA ACCOUNT STATUS:\n\n
                        üìä Portfolio Value: $${parseFloat(account.portfolio_value).toLocaleString()}\n
                        üí∞ Buying Power: $${parseFloat(account.buying_power).toLocaleString()}\n
                        üìà Equity: $${parseFloat(account.equity).toLocaleString()}\n
                        üîÑ Day Trade Count: ${account.daytrade_count}/3\n
                        üìÖ Pattern Day Trader: ${account.pattern_day_trader ? '‚úÖ' : '‚ùå'}\n
                        üö´ Trading Blocked: ${account.trading_blocked ? 'üî¥' : '‚úÖ'}\n\n
                        üìç Positionen: ${positions?.length || 0}\n
                        üìã Offene Orders: ${orders?.length || 0}
                    `;
                    
                    alert(accountInfo);
                } else {
                    showAlert('Keine Daten', 'Alpaca Account Daten nicht verf√ºgbar', 'warning');
                }
                
            } catch (error) {
                console.error('‚ùå Failed to load Alpaca account:', error);
                showAlert('Fehler', 'Konnte Alpaca Account nicht laden: ' + error.message, 'danger');
            }
        }
        
        // Load all Redis data for dashboard
        async function loadRedisData() {
            try {
                console.log('üîÑ Loading comprehensive Redis data...');
                
                const loadingToast = showAlert('Lade Daten', 'Redis Daten werden geladen...', 'info');
                
                // Load key data points
                const [
                    marketData,
                    alpacaAccount,
                    tradingSettings,
                    alpacaMode,
                    grokTop10,
                    predictions,
                    systemStatus
                ] = await Promise.all([
                    readFromRedisKey('market_data'),
                    readFromRedisKey('alpaca_account'),
                    readFromRedisKey('trading_settings'),
                    readFromRedisKey('alpaca_mode'),
                    readFromRedisKey('grok_top10'),
                    readFromRedisKey('predictions_current'),
                    readFromRedisKey('system_status')
                ]);
                
                console.log('üìä Loaded Redis Data:', {
                    marketData: marketData ? Object.keys(marketData).length : 0,
                    alpacaAccount: !!alpacaAccount,
                    tradingSettings,
                    alpacaMode,
                    grokTop10: grokTop10?.length || 0,
                    predictions: predictions ? Object.keys(predictions).length : 0,
                    systemStatus
                });
                
                // Update UI with loaded data
                if (alpacaMode) {
                    const switchElement = document.getElementById('tradingModeSwitch');
                    const modeText = document.getElementById('tradingModeText');
                    const modeBadge = document.getElementById('alpacaModeBadge');
                    
                    if (alpacaMode === 'live') {
                        switchElement.checked = true;
                        modeText.innerHTML = 'üî¥ LIVE Trading (ECHTES GELD!)';
                        modeBadge.className = 'badge bg-danger';
                        modeBadge.textContent = 'LIVE MODE';
                    } else {
                        switchElement.checked = false;
                        modeText.innerHTML = 'üìÑ Paper Trading (Sicher)';
                        modeBadge.className = 'badge bg-info';
                        modeBadge.textContent = 'Paper Mode';
                    }
                }
                
                // Update market data if available
                if (marketData) {
                    console.log('üìà Updating dashboard with market data...');
                    updateDashboardWithMarketData(marketData);
                }
                
                // Show success message
                showAlert('Daten Geladen', 
                         `‚úÖ Redis Daten erfolgreich geladen!\nüìä ${Object.keys(marketData || {}).length} Symbole\nü§ñ Trading Mode: ${alpacaMode}`, 
                         'success');
                
            } catch (error) {
                console.error('‚ùå Failed to load Redis data:', error);
                showAlert('Fehler', 'Konnte Redis Daten nicht laden: ' + error.message, 'danger');
            }
        }
        
        // Update dashboard with market data
        function updateDashboardWithMarketData(marketData) {
            // This function would update the stock cards with real Redis data
            // For now, just log the data
            console.log('üìà Market Data available for:', Object.keys(marketData));
            
            // TODO: Update stock price cards with real data
            // TODO: Update charts with real data
            // TODO: Update portfolio display with real data
        }
        
        // ====== REAL PORTFOLIO DATA FUNCTIONS ======
        
        async function loadRealPortfolioData() {
            try {
                console.log('üè¶ Loading REAL portfolio data from Alpaca via Redis...');
                
                showAlert('Portfolio Update', 'üîÑ Lade echte Alpaca Portfolio Daten...', 'info');
                
                const [alpacaAccount, alpacaPositions, alpacaOrders, tradingSettings] = await Promise.all([
                    readFromRedisKey('alpaca_account'),
                    readFromRedisKey('alpaca_positions'), 
                    readFromRedisKey('alpaca_orders'),
                    readFromRedisKey('trading_settings')
                ]);
                
                console.log('üè¶ Real Alpaca Data loaded:', {
                    account: alpacaAccount,
                    positions: alpacaPositions?.length || 0,
                    orders: alpacaOrders?.length || 0,
                    trading: tradingSettings
                });
                
                if (alpacaAccount) {
                    // Update Portfolio Value in Header
                    updatePortfolioHeader(alpacaAccount);
                    
                    // Update Dashboard Cards with Real Data
                    updateDashboardCards(alpacaAccount, alpacaPositions, alpacaOrders);
                    
                    // Update Charts with Real Portfolio History
                    await updatePortfolioCharts(alpacaAccount);
                    
                    showAlert('Portfolio Aktualisiert', 
                             `‚úÖ Echte Alpaca Daten geladen!\nüí∞ Portfolio: $${parseFloat(alpacaAccount.portfolio_value).toLocaleString()}\nüìç Positionen: ${alpacaPositions?.length || 0}`, 
                             'success');
                } else {
                    showAlert('Keine Portfolio Daten', '‚ö†Ô∏è Alpaca Account Daten nicht in Redis gefunden.\nPr√ºfen Sie die Backend Verbindung.', 'warning');
                }
                
            } catch (error) {
                console.error('‚ùå Failed to load real portfolio data:', error);
                showAlert('Portfolio Fehler', 'Konnte echte Portfolio Daten nicht laden: ' + error.message, 'danger');
            }
        }
        
        // Update Portfolio Value in Header
        function updatePortfolioHeader(alpacaAccount) {
            // Find portfolio display in header
            const portfolioElements = document.querySelectorAll('*');
            portfolioElements.forEach(element => {
                if (element.textContent && element.textContent.includes('Portfolio: $109,329')) {
                    const portfolioValue = parseFloat(alpacaAccount.portfolio_value);
                    const equity = parseFloat(alpacaAccount.equity);
                    const dayChange = ((equity / portfolioValue - 1) * 100) || 0;
                    const changeColor = dayChange >= 0 ? 'success' : 'danger';
                    const changeSymbol = dayChange >= 0 ? '+' : '';
                    
                    element.innerHTML = `Portfolio: $${portfolioValue.toLocaleString()} (${changeSymbol}${dayChange.toFixed(2)}%) <small class="text-${changeColor}">üî¥ LIVE ALPACA</small>`;
                }
            });
        }
        
        // Update Dashboard Cards with Real Data
        function updateDashboardCards(alpacaAccount, alpacaPositions, alpacaOrders) {
            // Update Total Value Card
            const totalValueElements = document.querySelectorAll('h3');
            totalValueElements.forEach(h3 => {
                if (h3.textContent.includes('$109,329')) {
                    const portfolioValue = parseFloat(alpacaAccount.portfolio_value);
                    h3.textContent = `$${portfolioValue.toLocaleString()}`;
                    h3.className = 'text-success';
                }
            });
            
            // Update Active Positions Card
            const positionElements = document.querySelectorAll('h3');
            positionElements.forEach(h3 => {
                if (h3.textContent === '12' && h3.parentElement.innerHTML.includes('Aktive Positionen')) {
                    const positionCount = alpacaPositions?.length || 0;
                    const longPositions = alpacaPositions?.filter(p => parseFloat(p.qty) > 0).length || 0;
                    const shortPositions = alpacaPositions?.filter(p => parseFloat(p.qty) < 0).length || 0;
                    
                    h3.textContent = positionCount.toString();
                    
                    // Update position breakdown
                    const breakdown = h3.parentNode.querySelector('p');
                    if (breakdown) {
                        breakdown.textContent = `${longPositions} Long, ${shortPositions} Short`;
                    }
                }
            });
            
            // Update Trading Status
            const tradingElements = document.querySelectorAll('h3');
            tradingElements.forEach(h3 => {
                if (h3.textContent === '23' && h3.parentElement.innerHTML.includes('Trades heute')) {
                    // This would need trades_log data for accurate count
                    h3.textContent = alpacaOrders?.filter(order => {
                        const today = new Date().toISOString().split('T')[0];
                        return order.created_at?.startsWith(today);
                    }).length || '0';
                }
            });
            
            // Update Account Status Details
            const statusText = document.querySelector('small.text-success');
            if (statusText && statusText.textContent.includes('LIVE AI MODEL')) {
                const dayTradeCount = alpacaAccount.daytrade_count || 0;
                const buyingPower = parseFloat(alpacaAccount.buying_power || 0);
                
                statusText.innerHTML = `üè¶ ALPACA LIVE - ${dayTradeCount}/3 Day Trades - $${buyingPower.toLocaleString()} Buying Power`;
            }
        }
        
        // Update Portfolio Charts with Real Data
        async function updatePortfolioCharts(alpacaAccount) {
            try {
                // Load portfolio equity history from Redis
                const portfolioEquity = await readFromRedisKey('portfolio_equity');
                
                if (portfolioEquity && portfolioEquity.length > 0) {
                    console.log('üìä Updating charts with real portfolio equity data');
                    
                    // Update the portfolio chart data
                    const chartData = portfolioEquity.slice(-30).map(entry => entry.equity_value);
                    const chartLabels = portfolioEquity.slice(-30).map(entry => 
                        new Date(entry.timestamp).toLocaleDateString('de-DE')
                    );
                    
                    // Find and update existing charts
                    if (typeof charts !== 'undefined' && charts.dashboardPortfolioMini) {
                        charts.dashboardPortfolioMini.data.datasets[0].data = chartData;
                        charts.dashboardPortfolioMini.data.labels = chartLabels;
                        charts.dashboardPortfolioMini.update();
                    }
                } else {
                    console.log('üìä No portfolio equity history found - using current value');
                    
                    // Create a simple trend with current value
                    const currentValue = parseFloat(alpacaAccount.portfolio_value);
                    const mockTrend = Array.from({length: 7}, (_, i) => {
                        const variance = (Math.random() - 0.5) * 0.02; // ¬±1% variance
                        return currentValue * (1 + variance);
                    });
                    
                    if (typeof charts !== 'undefined' && charts.dashboardPortfolioMini) {
                        charts.dashboardPortfolioMini.data.datasets[0].data = mockTrend;
                        charts.dashboardPortfolioMini.update();
                    }
                }
                
            } catch (error) {
                console.error('‚ùå Failed to update portfolio charts:', error);
            }
        }
        
        // ====== GROK AI FUNCTIONS ======
        
        async function loadGrokRecommendations() {
            try {
                console.log('ü§ñ Loading Grok AI recommendations...');
                const container = document.getElementById('grokRecommendations');
                
                container.innerHTML = '<div class="text-center"><i class="bi bi-hourglass-split"></i> Lade...</div>';
                
                const [grokTop10, grokDeeper] = await Promise.all([
                    readFromRedisKey('grok_top10'),
                    readFromRedisKey('grok_deepersearch')
                ]);
                
                console.log('ü§ñ Grok Data:', { top10: grokTop10?.length, deeper: grokDeeper?.length });
                
                let html = '';
                
                // Display Top 10 recommendations
                if (grokTop10 && grokTop10.length > 0) {
                    html += '<div class="mb-3"><strong>üöÄ Top Empfehlungen:</strong></div>';
                    grokTop10.slice(0, 5).forEach((rec, idx) => {
                        const scoreColor = rec.score > 0.8 ? 'success' : rec.score > 0.6 ? 'warning' : 'secondary';
                        html += `
                            <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-dark rounded">
                                <div>
                                    <strong class="text-primary">${rec.ticker}</strong>
                                    <br><small class="text-muted">${rec.reason}</small>
                                </div>
                                <span class="badge bg-${scoreColor}">${(rec.score * 100).toFixed(0)}%</span>
                            </div>
                        `;
                    });
                }
                
                // Display deeper analysis
                if (grokDeeper && grokDeeper.length > 0) {
                    html += '<div class="mt-3 mb-2"><strong>üîç Detailanalyse:</strong></div>';
                    grokDeeper.slice(0, 3).forEach(analysis => {
                        const sentimentColor = analysis.sentiment > 0.7 ? 'success' : analysis.sentiment > 0.4 ? 'warning' : 'danger';
                        html += `
                            <div class="mb-2 p-2 bg-dark rounded">
                                <div class="d-flex justify-content-between">
                                    <strong class="text-info">${analysis.ticker}</strong>
                                    <span class="badge bg-${sentimentColor}">${(analysis.sentiment * 100).toFixed(0)}%</span>
                                </div>
                                <small class="text-light">${analysis.explanation_de}</small>
                            </div>
                        `;
                    });
                }
                
                if (!html) {
                    html = '<div class="text-center text-muted">Keine Grok Daten verf√ºgbar</div>';
                }
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('‚ùå Failed to load Grok recommendations:', error);
                document.getElementById('grokRecommendations').innerHTML = 
                    `<div class="text-danger"><i class="bi bi-exclamation-triangle"></i> Fehler: ${error.message}</div>`;
            }
        }
        
        // ====== ML PREDICTIONS FUNCTIONS ======
        
        async function loadMLPredictions() {
            try {
                console.log('üß† Loading ML predictions...');
                const container = document.getElementById('mlPredictions');
                
                container.innerHTML = '<div class="text-center"><i class="bi bi-hourglass-split"></i> Lade...</div>';
                
                const predictions = await readFromRedisKey('predictions_current');
                
                console.log('üß† ML Predictions:', predictions ? Object.keys(predictions).length : 0);
                
                let html = '';
                
                if (predictions && Object.keys(predictions).length > 0) {
                    const tickers = Object.keys(predictions).slice(0, 5); // Show top 5
                    
                    tickers.forEach(ticker => {
                        const pred = predictions[ticker];
                        const current = pred.current_price;
                        const horizons = pred.horizons;
                        
                        html += `<div class="mb-3 p-2 bg-dark rounded">`;
                        html += `<div class="d-flex justify-content-between mb-2">`;
                        html += `<strong class="text-warning">${ticker}</strong>`;
                        html += `<span class="text-muted">$${current.toFixed(2)}</span>`;
                        html += `</div>`;
                        
                        // Show predictions for each time horizon
                        if (horizons) {
                            ['15', '30', '60'].forEach(horizon => {
                                if (horizons[horizon]) {
                                    const h = horizons[horizon];
                                    const changeColor = h.change_pct > 0 ? 'success' : 'danger';
                                    const changeIcon = h.change_pct > 0 ? 'üìà' : 'üìâ';
                                    
                                    html += `
                                        <div class="d-flex justify-content-between small">
                                            <span>${horizon}min: $${h.predicted_price.toFixed(2)}</span>
                                            <span class="text-${changeColor}">${changeIcon} ${(h.change_pct * 100).toFixed(2)}%</span>
                                        </div>
                                    `;
                                }
                            });
                        }
                        
                        html += `</div>`;
                    });
                } else {
                    html = '<div class="text-center text-muted">Keine ML Predictions verf√ºgbar</div>';
                }
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('‚ùå Failed to load ML predictions:', error);
                document.getElementById('mlPredictions').innerHTML = 
                    `<div class="text-danger"><i class="bi bi-exclamation-triangle"></i> Fehler: ${error.message}</div>`;
            }
        }
        
        // ====== TRADES LOG FUNCTIONS ======
        
        async function loadTradesLog() {
            try {
                console.log('üìã Loading trades log from Redis...');
                
                const tradesLog = await readFromRedisKey('trades_log');
                
                console.log('üìã Trades Log:', tradesLog?.length || 0, 'entries');
                
                if (tradesLog && tradesLog.length > 0) {
                    // Update the recent activity section with real trades
                    const activityContainer = document.querySelector('.list-group');
                    
                    let html = '';
                    tradesLog.slice(0, 10).forEach(trade => {
                        const timeAgo = getTimeAgo(trade.time);
                        const sideIcon = trade.side === 'buy' ? 'arrow-up-circle text-success' : 'arrow-down-circle text-danger';
                        const action = trade.side === 'buy' ? 'Kauf' : 'Verkauf';
                        
                        html += `
                            <div class="list-group-item bg-transparent border-secondary">
                                <div class="d-flex justify-content-between">
                                    <span><i class="bi bi-${sideIcon}"></i> ${trade.ticker} ${action} - ${trade.qty} Shares @ $${trade.current_price.toFixed(2)}</span>
                                    <span class="text-muted">${timeAgo}</span>
                                </div>
                                <small class="text-muted">Predicted: $${trade.predicted_price.toFixed(2)} (${(trade.change_pct * 100).toFixed(2)}%)</small>
                            </div>
                        `;
                    });
                    
                    if (activityContainer) {
                        activityContainer.innerHTML = html;
                    }
                    
                    showAlert('Trades Loaded', `‚úÖ ${tradesLog.length} Trades aus Redis geladen`, 'success');
                } else {
                    showAlert('Keine Trades', 'Keine Trades im Redis Log gefunden', 'info');
                }
                
            } catch (error) {
                console.error('‚ùå Failed to load trades log:', error);
                showAlert('Fehler', 'Konnte Trades Log nicht laden: ' + error.message, 'danger');
            }
        }
        
        // Helper function to calculate time ago
        function getTimeAgo(timestamp) {
            const now = new Date();
            const time = new Date(timestamp);
            const diffMs = now - time;
            const diffMins = Math.floor(diffMs / (1000 * 60));
            
            if (diffMins < 1) return 'gerade eben';
            if (diffMins < 60) return `vor ${diffMins} Min`;
            
            const diffHours = Math.floor(diffMins / 60);
            if (diffHours < 24) return `vor ${diffHours} Std`;
            
            const diffDays = Math.floor(diffHours / 24);
            return `vor ${diffDays} Tag${diffDays > 1 ? 'en' : ''}`;
        }
        
        // Utility function to show alerts
        function showAlert(title, message, type = 'info') {
            // Enhanced alert with better console formatting
            const icons = {
                'success': '‚úÖ',
                'danger': '‚ùå', 
                'warning': '‚ö†Ô∏è',
                'info': '‚ÑπÔ∏è'
            };
            
            const icon = icons[type] || '‚ÑπÔ∏è';
            console.log(`${icon} ${type.toUpperCase()}: ${title} - ${message}`);
            
            // Create simple alert for critical messages
            if (type === 'danger' && message.includes('Redis')) {
                // Don't show popup for Redis errors - they're handled gracefully with simulation
                return null;
            }
            
            return null;
        }
        
        // Simple dark theme setup
        function setupDarkTheme() {
            console.log('üé® Setting up dark theme...');
            document.documentElement.setAttribute('data-bs-theme', 'dark');
            console.log('‚úÖ Dark theme set');
        }
        
        // Initialize Redis integration on page load
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ Initializing Redis integration...');
            
            // Simple dark theme setup
            setupDarkTheme();
            
            // Load initial data from Redis
            setTimeout(async () => {
                try {
                    const alpacaMode = await readFromRedisKey('alpaca_mode');
                    if (alpacaMode) {
                        console.log('üìä Current Alpaca Mode:', alpacaMode);
                        
                        const switchElement = document.getElementById('tradingModeSwitch');
                        if (switchElement) {
                            switchElement.checked = (alpacaMode === 'live');
                            
                            // Trigger the change event to update UI
                            const event = new Event('change');
                            switchElement.dispatchEvent(event);
                        }
                    }
                    
                    // Auto-load real portfolio data on startup
                    console.log('üè¶ Auto-loading real portfolio data...');
                    await loadRealPortfolioData();
                    
                } catch (error) {
                    console.error('‚ùå Failed to initialize Redis integration:', error);
                }
            }, 2000); // Increased delay for better loading
        });
        
        console.log('‚úÖ 6bot Trading Suite with Redis Integration loaded successfully');
    </script>
</body>
</html>